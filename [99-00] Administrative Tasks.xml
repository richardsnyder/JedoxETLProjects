<?xml version="1.0" encoding="UTF-8"?>
<project name="[99-00] Administrative Tasks" version="20.3" modified="1602552603502" modifiedBy="ONEPAS\richards" olapId="p15">
  <headers>
    <header name="comment" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment>This project is for updating system cubes (#_Parameters) or attributes in dimensions based on the values in #_Parameters.</comment>
    </header>
  </headers>
  <variables>
    <variable modified="1602549892330" name="CurrYear" modifiedBy="ONEPAS\richards">
      <comment />
      <default>2017</default>
    </variable>
    <variable modified="1602549892330" name="PrevYear" modifiedBy="ONEPAS\richards">
      <comment />
      <default>2016</default>
    </variable>
    <variable modified="1602549892330" name="BudYear" modifiedBy="ONEPAS\richards">
      <comment />
      <default>2017</default>
    </variable>
  </variables>
  <connections>
    <connection name="CurrentWeekTextFile" type="File" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <location type="FileSystem" />
      <database>C:\Progra~1\Jedox\Jedox Suite\tomcat\client\CurrentWeek.txt</database>
      <header>false</header>
      <delimiter>,</delimiter>
      <quote>#none</quote>
      <enableEscape>false</enableEscape>
    </connection>
    <connection modified="1602549892330" name="Jedox" type="JedoxOlap" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[This is the "main" Jedox connection that is used for all connections to the PAS-DEV database.]]></comment>
      <global nameref="localhost" />
      <database>PAS-Financials</database>
      <ssl>off</ssl>
    </connection>
    <connection modified="1602552569239" name="DW" type="Sqlserver" modifiedBy="ONEPAS\richards">
      <global nameref="DW" />
    </connection>
    <connection name="Parameter Cube Contents" type="File" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <location type="FileSystem" />
      <comment><![CDATA[Contains the value of the #_parameter cube]]></comment>
      <database>C:\Progra~1\Jedox\Jedox Suite\tomcat\client\ParameterCube.txt</database>
      <header>false</header>
      <delimiter>#space</delimiter>
      <quote>#none</quote>
      <enableEscape>false</enableEscape>
    </connection>
    <connection modified="1602552603502" name="AP21" type="Oracle" modifiedBy="ONEPAS\richards">
      <global nameref="AP21" />
    </connection>
    <connection name="file-SalesDailyUpdate" type="File" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <location type="FileSystem" />
      <comment><![CDATA[Used for sending the SalesDaily update times in an email.]]></comment>
      <database>C:\Program Files\Jedox\Jedox Suite\tomcat\client\SailesDailyUpdate.txt</database>
      <header>true</header>
      <delimiter>,</delimiter>
      <quote>#none</quote>
      <enableEscape>false</enableEscape>
    </connection>
    <connection name="Jedox System Cubes" type="JedoxOlap" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <host>localhost</host>
      <port>7777</port>
      <user>admin</user>
      <database>System</database>
      <password encryption="AES">kUdvvoBnlqH8ua02/w1L2lQssD55</password>
    </connection>
    <connection name="Stat PandL Check" type="File" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <location type="FileSystem" />
      <database>C:\Progra~1\Jedox\Jedox Suite\tomcat\client\StatPandLCheck.txt</database>
      <delimiter>#space</delimiter>
      <quote>#none</quote>
      <ssl>verify</ssl>
      <enableEscape>false</enableEscape>
      <header>false</header>
    </connection>
    <connection modified="1602552584628" name="DW Raw" type="Sqlserver" modifiedBy="ONEPAS\richards">
      <global nameref="DW Raw" />
    </connection>
    <connection modified="1602549892330" name="Review Concession Profit Centre  Check" type="File" modifiedBy="ONEPAS\richards">
      <location type="FileSystem" />
      <database>C:\Progra~1\Jedox\Jedox Suite\tomcat\client\ReviewConcessionProfitCentreCheck.txt</database>
      <delimiter>#space</delimiter>
      <quote>#none</quote>
      <enableEscape>false</enableEscape>
      <header>false</header>
    </connection>
  </connections>
  <extracts>
    <extract name="ex-Jedox [Attr]: Parameters (Period)" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Is used to extract the FYear(CurrYear) for following :
1- Copy Act 2 Fcst
2- Copy  Fcst_mmm]]></comment>
      <connection nameref="Jedox" />
      <query celltype="only_string" drillthrough="false" onlyBasisAsDefault="true" useRules="false" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="Parameter">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Period]]></condition>
          </dimension>
          <dimension name="#_Parameter_">
            <condition operator="equal" type="accept"><![CDATA[Item]]></condition>
          </dimension>
        </dimensions>
        <cube name="#_Parameter" />
      </query>
    </extract>
    <extract name="ex-Jedox [Dim]: Period" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extracts the base level periods of the period dimension.
This will be used to join the Current Period extracted from the #_Parameters cube.]]></comment>
      <connection nameref="Jedox" />
      <query>
        <dimension name="Period">
          <condition operator="equal" mode="onlyBases" type="accept"><![CDATA[Base Periods]]></condition>
        </dimension>
      </query>
      <attributesMode>none</attributesMode>
    </extract>
    <extract name="ex-Jedox [Attr]: Parameters (Week)" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Is used to extract the FYear(CurrYear) for following :
1- Copy Act 2 Fcst
2- Copy  Fcst_mmm]]></comment>
      <connection nameref="Jedox" />
      <query celltype="only_string" drillthrough="false" onlyBasisAsDefault="true" useRules="false" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="Parameter">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Week]]></condition>
          </dimension>
          <dimension name="#_Parameter_">
            <condition operator="equal" type="accept"><![CDATA[Item]]></condition>
          </dimension>
        </dimensions>
        <cube name="#_Parameter" />
      </query>
    </extract>
    <extract name="ex-Jedox [Dim]: Week" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extracts the base level periods of the period dimension.
This will be used to join the Current Period extracted from the #_Parameters cube.]]></comment>
      <connection nameref="Jedox" />
      <query>
        <dimension name="Week">
          <condition operator="equal" mode="onlyBases" type="accept"><![CDATA[Week Base Periods]]></condition>
        </dimension>
      </query>
      <attributesMode>none</attributesMode>
    </extract>
    <extract name="ex-Jedox [Attr]: Parameters (Year)" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Is used to extract the FYear(CurrYear) for following :
1- Copy Act 2 Fcst
2- Copy  Fcst_mmm]]></comment>
      <connection nameref="Jedox" />
      <query useRules="false" onlyBasisAsDefault="true" celltype="only_string" zeroSuppressionType="excludeEmpty">
        <cube name="#_Parameter" />
        <dimensions>
          <dimension name="Parameter">
            <condition operator="equal" mode="onlyBases" type="accept"><![CDATA[CurrYear]]></condition>
          </dimension>
        </dimensions>
      </query>
    </extract>
    <extract name="ex-Jedox [Dim]: Year" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extracts the base level periods of the period dimension.
This will be used to join the Current Period extracted from the #_Parameters cube.]]></comment>
      <connection nameref="Jedox" />
      <query>
        <dimension name="FYear">
          <condition operator="inRange" mode="onlyBases" type="accept"><![CDATA[[2005,2999]]]></condition>
        </dimension>
      </query>
      <attributesMode>none</attributesMode>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Dim] Week - Current Retail Week" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extract the current retail week based on the current date.]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[select 'Item' [#_Parameter_]
, 'Week'  Parameter
,Format(Convert(Int,SysConfiguration.ConfigurationValue), 'WK00')  [#Value]
from DataWarehouse.dbo.SysConfiguration 
where SysConfiguration.ConfigurationKey = 'ReportingRetailWeek'
/* 
UNION ALL
select 'Item' [#_Parameter_]
, 'CurrYearETL'  Parameter
,SysConfiguration.ConfigurationValue [#Value]
from DataWarehouse.dbo.SysConfiguration 
where SysConfiguration.ConfigurationKey = 'ETLCurrRetailYear'
UNION ALL
select 'Item' [#_Parameter_]
, 'RetailWeekCurrYear'  Parameter
,SysConfiguration.ConfigurationValue [#Value]
from DataWarehouse.dbo.SysConfiguration 
where SysConfiguration.ConfigurationKey = 'ETLCurrRetailYear'
UNION ALL
select 'Item' [#_Parameter_]
, 'RetailDayCurrYear'  Parameter
,SysConfiguration.ConfigurationValue [#Value]
from DataWarehouse.dbo.SysConfiguration 
where SysConfiguration.ConfigurationKey = 'ETLCurrRetailYear'
UNION ALL
select 'Item' [#_Parameter_]
, 'PrevYearETL'  Parameter
,SysConfiguration.ConfigurationValue [#Value]
from DataWarehouse.dbo.SysConfiguration 
where SysConfiguration.ConfigurationKey = 'ETLPrevRetailYear'
*/  
  
/*
select 'Item' [#_Parameter_]
, 'Week'  Parameter
,Format(Convert(Int,SysConfiguration.ConfigurationValue), 'WK00')  [#Value]
from DataWarehouse.dbo.SysConfiguration 
where SysConfiguration.ConfigurationKey = 'ReportingRetailWeek'
*/
/* ORIGINAL QUERY FROM MTWSQL04 */
/*
select 'Item' [#_Parameter_]
, 'Week'  Parameter
,case when RetWeek < 10 then 'WK0'+RetWeek else 'WK'+RetWeek end  [#Value]
from ptime 
where CalDate = CONVERT(date, getdate())
*/]]></query>
      <alias_map>
        <alias origin="#_Parameter_">1</alias>
        <alias origin="Parameter">2</alias>
        <alias origin="#Value">3</alias>
      </alias_map>
    </extract>
    <extract name="ex FY14 Actual For Copy to Forecast" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query celltype="both" drillthrough="false" onlyBasisAsDefault="true" useRules="false" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="FYear">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[2014]]></condition>
          </dimension>
          <dimension name="Version">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Actual]]></condition>
          </dimension>
          <dimension name="Weekly Retail Measure">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Weekly Retail ETL Measures]]></condition>
          </dimension>
        </dimensions>
        <cube name="Retail Sales Weekly" />
      </query>
    </extract>
    <extract name="Duplicate of ex-Jedox [Dim]: Week" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extracts the base level periods of the period dimension.
This will be used to join the Current Period extracted from the #_Parameters cube.]]></comment>
      <connection nameref="Jedox" />
      <query>
        <dimension name="Week" />
      </query>
      <attributesMode>standardAttributes</attributesMode>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Store Calendar] Store Status Dates" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extracts the Store Open, Store Closed, Refurb Start and RefurbEnd dates from the profit centre view (vProfCen)
for loading into the Store Calendar cube - store status elements]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[/* =========== Actual Start ============ */
/* Actual Open Date */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.OpenDate,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.OpenDate IS NOT NULL

UNION 

/* Actual Close */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'StoreCloseDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.CloseDate,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.CloseDate IS NOT NULL

UNION 

/* Actual Refurbish Start Date */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'RefurbStartDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.RefurbishStartDate,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.RefurbishStartDate IS NOT NULL

UNION 

/* Actual Refurbish End Date */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'RefurbEndDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.RefurbishEndDate,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.RefurbishEndDate IS NOT NULL

/* =========== Actual End ============ */

UNION

/* =========== Budget Start ============ */
/* Budget Open Date */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDate' AS [Store Status]
, case when DimDate.FinancialYear < (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear') 
    then CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.BudgetOpenDateCurrentYear,DimProfitCentre.BudgetOpenDate),112) 
    else CONVERT(VARCHAR(12), DimProfitCentre.BudgetOpenDate,112)
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
--AND DimProfitCentre.BudgetOpenDateCurrentYear IS NOT NULL
--AND DimProfitCentre.BudgetOpenDate IS NOT NULL
UNION 

/* Budget Close Date */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'StoreCloseDate' AS [Store Status]
, case when DimDate.FinancialYear < (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear') 
    then CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.BudgetCloseDateCurrentYear,DimProfitCentre.BudgetCloseDate),112) 
    else CONVERT(VARCHAR(12), DimProfitCentre.BudgetCloseDate,112)
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
--AND DimProfitCentre.BudgetCloseDateCurrentYear IS NOT NULL
--AND DimProfitCentre.BudgetCloseDate IS NOT NULL
UNION

/* Budget Refurb Start Date */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'RefurbStartDate' AS [Store Status]
, case when DimDate.FinancialYear < (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear') 
    then CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.RefurbishStartDateBudgetCurrentYear,DimProfitCentre.RefurbishStartDateBudgetCurrentYear),112) 
    else CONVERT(VARCHAR(12), DimProfitCentre.RefurbishStartDateBudget,112)
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
--AND DimProfitCentre.RefurbishStartDateBudget IS NOT NULL

UNION

/* Budget Refurb End Date */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'RefurbEndDate' AS [Store Status]
, case when DimDate.FinancialYear < (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear') 
    then CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.RefurbishEndDateBudgetCurrentYear,DimProfitCentre.RefurbishEndDateBudgetCurrentYear),112) 
    else CONVERT(VARCHAR(12), DimProfitCentre.RefurbishEndDateBudget,112)
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
--AND DimProfitCentre.RefurbishEndDateBudget IS NOT NULL

/* =========== Budget End ============ */

UNION

/* =========== Forecast Start ============ */
/* Forecast Open Date */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.ForecastOpenDate, 112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.ForecastOpenDate IS NOT NULL

UNION

/* Forecast Close Date */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'StoreCloseDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.ForecastCloseDate, 112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.ForecastCloseDate IS NOT NULL

UNION

/* Forecast Refurbish Start Date */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'RefurbStartDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.RefurbishStartDateForecast,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
--AND DimProfitCentre.RefurbishStartDateForecast IS NOT NULL

UNION

/* Forecast Refurbish End Date */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'RefurbEndDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.RefurbishEndDateForecast, 112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
--AND DimProfitCentre.RefurbishEndDateForecast IS NOT NULL
/* =========== Forecast End ============ */

UNION

/* =========== Serial Date Start ============ */
/* =============  Actual Start ============ */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDateS' AS [Store Status]
, CONVERT(VARCHAR(15), DATEDIFF(dd, '19700101', CONVERT(VARCHAR(12), DimProfitCentre.OpenDate,112))) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.OpenDate IS NOT NULL
/* =============  Actual End ============ */

UNION

/* =============  Budget Start ============ */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDateS' AS [Store Status]
, case when DimDate.FinancialYear <= (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear') 
    then DATEDIFF(dd, '19700101', CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.BudgetOpenDateCurrentYear,DimProfitCentre.BudgetOpenDate), 112)) 
    else DATEDIFF(dd, '19700101', CONVERT(VARCHAR(12), DimProfitCentre.BudgetOpenDate, 112))
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND COALESCE(DimProfitCentre.BudgetOpenDateCurrentYear,DimProfitCentre.BudgetOpenDate) IS NOT NULL
--AND DimProfitCentre.BudgetOpenDate IS NOT NULL
AND DimProfitCentre.code = 1434
/* =============  Budget End ============ */

UNION

/* =============  Forecast Start ============ */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.FinancialMonth, '\P00') AS [Period]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDateS' AS [Store Status]
,  DATEDIFF(dd, '19700101', CONVERT(VARCHAR(12),DimProfitCentre.ForecastOpenDate, 112)) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.ForecastOpenDate IS NOT NULL
/* =============  Forecast End ============ */
/* =========== Serial Date End ============ */]]></query>
      <alias_map>
        <alias origin="Version">1</alias>
        <alias origin="Year">2</alias>
        <alias origin="Period">3</alias>
        <alias origin="Store">4</alias>
        <alias origin="Store Status">5</alias>
        <alias origin="#Value">6</alias>
      </alias_map>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Store Calendar Week ] Store Status Dates" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extracts the Store Open, Store Closed, Refurb Start and RefurbEnd dates from the profit centre view (vProfCen)
for loading into the Store Calendar cube - store status elements]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[/* =========== Actual Start ============ */
/* Actual Open Date */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.OpenDate,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.OpenDate IS NOT NULL

UNION 

/* Actual Close */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'StoreCloseDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.CloseDate,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.CloseDate IS NOT NULL

UNION 

/* Actual Refurbish Start Date */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'RefurbStartDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.RefurbishStartDate,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.RefurbishStartDate IS NOT NULL

UNION 

/* Actual Refurbish End Date */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'RefurbEndDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.RefurbishEndDate,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.RefurbishEndDate IS NOT NULL

/* =========== Actual End ============ */

UNION

/* =========== Budget Start ============ */
/* Budget Open Date */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDate' AS [Store Status]
, case when DimDate.FinancialYear <= (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear') 
    then CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.BudgetOpenDateCurrentYear,DimProfitCentre.BudgetOpenDate),112) 
    else CONVERT(VARCHAR(12), DimProfitCentre.BudgetOpenDate,112)
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
--AND DimProfitCentre.BudgetOpenDateCurrentYear IS NOT NULL
--AND DimProfitCentre.BudgetOpenDate IS NOT NULL

UNION 

/* Budget Close Date */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'StoreCloseDate' AS [Store Status]
, case when DimDate.FinancialYear <= (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear') 
    then CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.BudgetCloseDateCurrentYear,DimProfitCentre.BudgetCloseDate),112) 
    else CONVERT(VARCHAR(12), DimProfitCentre.BudgetCloseDate,112)
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
--AND DimProfitCentre.BudgetCloseDateCurrentYear IS NOT NULL
--AND DimProfitCentre.BudgetCloseDate IS NOT NULL

UNION

/* Budget Refurb Start Date */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'RefurbStartDate' AS [Store Status]
, case when DimDate.FinancialYear <= (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear') 
    then CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.RefurbishStartDateBudgetCurrentYear,DimProfitCentre.RefurbishStartDateBudget),112) 
    else CONVERT(VARCHAR(12), DimProfitCentre.RefurbishStartDateBudget,112)
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.RefurbishStartDate IS NOT NULL

UNION

/* Budget Refurb End Date */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'RefurbEndDate' AS [Store Status]
, case when DimDate.FinancialYear <= (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear') 
    then CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.RefurbishEndDateBudgetCurrentYear,DimProfitCentre.RefurbishEndDateBudget), 112) 
    else CONVERT(VARCHAR(12), DimProfitCentre.RefurbishEndDateBudget,112)
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.RefurbishEndDate IS NOT NULL

/* =========== Budget End ============ */

UNION

/* =========== Forecast Start ============ */
/* Forecast Open Date */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.ForecastOpenDate, 112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.ForecastOpenDate IS NOT NULL

UNION

/* Forecast Close Date */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'StoreCloseDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.ForecastCloseDate, 112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.ForecastCloseDate IS NOT NULL

UNION

/* Forecast Refurbish Start Date */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'RefurbStartDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.RefurbishStartDateForecast,112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.RefurbishStartDate IS NOT NULL

UNION

/* Forecast Refurbish End Date */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'RefurbEndDate' AS [Store Status]
, CONVERT(VARCHAR(12), DimProfitCentre.RefurbishEndDateForecast, 112) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.RefurbishEndDate IS NOT NULL
/* =========== Forecast End ============ */

UNION

/* =========== Serial Date Start ============ */
/* =============  Actual Start ============ */
SELECT DISTINCT 'Actual' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDateS' AS [Store Status]
, CONVERT(VARCHAR(15), DATEDIFF(dd, '19700101', CONVERT(VARCHAR(12), DimProfitCentre.OpenDate,112))) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.OpenDate IS NOT NULL
/* =============  Actual End ============ */

UNION

/* =============  Budget Start ============ */
SELECT DISTINCT 'Budget' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDateS' AS [Store Status]
, case when DimDate.FinancialYear <= (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear') 
    then DATEDIFF(dd, '19700101', CONVERT(VARCHAR(12), COALESCE(DimProfitCentre.BudgetOpenDateCurrentYear,DimProfitCentre.BudgetOpenDate), 112)) 
    else DATEDIFF(dd, '19700101', CONVERT(VARCHAR(12), DimProfitCentre.BudgetOpenDate, 112))
  end
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND COALESCE(DimProfitCentre.BudgetOpenDateCurrentYear,DimProfitCentre.BudgetOpenDate) IS NOT NULL
--AND DimProfitCentre.BudgetOpenDate IS NOT NULL
/* =============  Budget End ============ */

UNION

/* =============  Forecast Start ============ */
SELECT DISTINCT 'Forecast' [Version]
, DimDate.FinancialYear AS [Year]
, FORMAT(DimDate.RetailWeek, 'WK00') AS [Week]
, DimProfitCentre.Code AS [Store]
, 'StoreOpenDateS' AS [Store Status]
,  DATEDIFF(dd, '19700101', CONVERT(VARCHAR(12),DimProfitCentre.ForecastOpenDate, 112)) AS [#Value]
FROM DataWarehouse.dbo.DimProfitCentre
, DataWarehouse.dbo.DimDate
WHERE 1=1
AND DimDate.FinancialMonth in (SELECT DISTINCT FinancialMonth FROM DataWarehouse.dbo.DimDate WHERE FinancialYear = (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLCurrRetailYear'))
AND DimDate.FinancialYear BETWEEN (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLPrevRetailYear') AND (SELECT ConfigurationValue from DataWarehouse.dbo.SysConfiguration WHERE ConfigurationKey = 'ETLBudRetailYear')
AND DimProfitCentre.ProfitCentreType IN ('RT','CO','OU','RH','EC')
AND DimProfitCentre.ForecastOpenDate IS NOT NULL
/* =============  Forecast End ============ */
/* =========== Serial Date End ============ */]]></query>
      <alias_map>
        <alias origin="Version">1</alias>
        <alias origin="Year">2</alias>
        <alias origin="Week">3</alias>
        <alias origin="Store">4</alias>
        <alias origin="Store Status">5</alias>
        <alias origin="#Value">6</alias>
      </alias_map>
    </extract>
    <extract modified="1602549892330" name="ex-DW [vProfCen] Profit Centre Attribute Checksum" type="Relational" modifiedBy="ONEPAS\richards">
      <connection nameref="DW" />
      <query><![CDATA[SET CONCAT_NULL_YIELDS_NULL OFF

SELECT [Code]
  + [Name]
  + [ProfitCentreType]
  + [State]
  + [Country]
  + CONVERT(VARCHAR(12),[AreaInSquareMeters])
  + CONVERT(VARCHAR(12),[StartupCapitalExpenditure])
  + [StoreGrading]
  + CONVERT(VARCHAR(12),[OpenDate])
  + CONVERT(VARCHAR(12),[CloseDate])
  + CONVERT(VARCHAR(12),[BudgetOpenDate])
  + CONVERT(VARCHAR(12),[BudgetCloseDate])
  + CONVERT(VARCHAR(12), [BudgetOpenDateCurrentYear])
  + CONVERT(VARCHAR(12),[BudgetCloseDateCurrentYear])
  + CONVERT(VARCHAR(12),[ForecastOpenDate])
  + CONVERT(VARCHAR(12),[ForecastCloseDate])
  + CONVERT(VARCHAR(12),[RefurbishStartDate])
  + CONVERT(VARCHAR(12),[RefurbishEndDate])
  + CONVERT(VARCHAR(12),[RefurbishStartDateBudget])
  + CONVERT(VARCHAR(12),[RefurbishEndDateBudget])
  + CONVERT(VARCHAR(12),[RefurbishStartDateBudgetCurrentYear])
  + CONVERT(VARCHAR(12),[RefurbishEndDateBudgetCurrentYear])
  + CONVERT(VARCHAR(12),[RefurbishStartDateForecast])
  + CONVERT(VARCHAR(12),[RefurbishEndDateForecast])
  + CONVERT(VARCHAR(12),[CurrentBusinessDivisionId])
  + CONVERT(VARCHAR(12),[CurrentLegalEntityId])
  + CONVERT(VARCHAR(12),[IsLegacy])
  + CONVERT(VARCHAR(12),[ProfitCentreCurrencyId]) AS storestatus
INTO #a
FROM [dbo].[DimProfitCentre]
SET CONCAT_NULL_YIELDS_NULL ON

DECLARE @Txt1 VARCHAR(MAX)
SET @Txt1=''
 
SELECT  @Txt1 = @Txt1 + storestatus 
FROM    #a

SELECT 'ETLProfitCentreAttributeChecksum' as [ConfigurationKey], GetDate() as [Date], '' as [Description],  checksum(LEFT(@Txt1,LEN(@Txt1)-1)) as 'Value'

drop table #a]]></query>
    </extract>
    <extract name="ex-AP21 Store Polling Data (Raw)" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extract from the Store view in AP21]]></comment>
      <connection nameref="AP21" />
      <query><![CDATA[select widx, code, name, last_contact, last_sale from stores where last_contact is not null]]></query>
    </extract>
    <extract name="ex-DW AP21 Store Polling Data (Transform)" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Combine the raw AP21 store polling data with the location details from the data warehouse.]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[select COALESCE(l.ProfCen,lm.ProfCen,lb.ProfCen) ProfCen
, COALESCE(l.LocationCode, lm.LocationCode,lb.LocationCode) LocationCode
, COALESCE(l.Description, lm.Description, lb.Description) Description
, a.LAST_CONTACT
, a.LAST_SALE
, convert(varchar(8), Last_Contact, 112) RetailDay
from AP21_Store_Polling_Data a
left join PAS_DWH.dbo.location l on a.CODE = l.LocationCode
left join PAS_DWH_ME.ME.Location lm on a.code = lm.locationCode
left join PAS_DWH_BY.[BY].Location lb on a.code = lb.LocationCode
order by 1]]></query>
    </extract>
    <extract name="ex-DW SalesDaily Update Time" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extract the most recent update date/time of the SalesDaily table that is used to populate the Retail Weekly Sales cube]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[select 'SalesDaily Update Date' Activity, GetDate() 'Date', 'Review SalesDaily Update' Description, Cast(UpdateDate as DateTime) "Value" from PAS_DWH.dbo.runlog where UpdateDate = (select max(UpdateDate) from PAS_DWH.dbo.runlog)
union
select 'SalesDaily Update Date' Activity, GetDate() 'Date', 'Metalicus SalesDaily Update' Description, Cast(UpdateDate as DateTime) "Value" from PAS_DWH_ME.ME.runlog where UpdateDate = (select max(UpdateDate) from PAS_DWH_ME.ME.runlog)
union
select 'SalesDaily Update Date' Activity, GetDate() 'Date' ,'Breakaway SalesDaily Update' Description, Cast(UpdateDate as DateTime) "Value" from PAS_DWH_BY.[BY].runlog where UpdateDate = (select max(UpdateDate) from PAS_DWH_BY.[BY].runlog)
union
select 'SalesDaily Update Date' Activity, GetDate() 'Date' ,'Yarra Trail SalesDaily Update' Description, Cast(UpdateDate as DateTime) "Value" from PAS_DWH_BY.[BY].runlog where UpdateDate = (select max(UpdateDate) from PAS_DWH_BY.[BY].runlog)
order by 4
/* Original Query */
/*
select 'SalesDaily Update Date' Activity, GetDate() 'Date', 'Review SalesDaily Update' Description, convert(varchar(30), UpdateDate, 109) "Value" from PAS_DWH.dbo.runlog where UpdateDate = (select max(UpdateDate) from PAS_DWH.dbo.runlog)
union
select 'SalesDaily Update Date' Activity, GetDate() 'Date', 'Metalicus SalesDaily Update' Description, convert(varchar(30), UpdateDate, 109) "Value" from PAS_DWH_ME.ME.runlog where UpdateDate = (select max(UpdateDate) from PAS_DWH_ME.ME.runlog)
union
select 'SalesDaily Update Date' Activity, GetDate() 'Date' ,'Breakaway SalesDaily Update' Description, convert(varchar(30), UpdateDate, 109) "Value" from PAS_DWH_BY.[BY].runlog where UpdateDate = (select max(UpdateDate) from PAS_DWH_BY.[BY].runlog)
order by 4
*/]]></query>
      <alias_map>
        <alias origin="Activity">1</alias>
        <alias origin="Date">2</alias>
        <alias origin="Description">3</alias>
        <alias origin="Value">4</alias>
      </alias_map>
    </extract>
    <extract modified="1602549892330" name="ex-Jedox [Cube]: Store Calendar Week" type="Cube" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query celltype="both" drillthrough="false" onlyBasisAsDefault="true" useRules="true" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="FYear">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${PrevYear}]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${CurrYear}]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${BudYear}]]></condition>
          </dimension>
          <dimension name="Week">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Week Base Periods]]></condition>
            <condition mode="onlyBases" operator="equal" type="deny"><![CDATA[Please select a week]]></condition>
          </dimension>
          <dimension name="Store Status">
            <condition mode="onlyBases" operator="like" type="accept"><![CDATA[Comp Type]]></condition>
          </dimension>
          <dimension name="Store">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Retail]]></condition>
          </dimension>
          <dimension name="Version">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Actual]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Budget]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Forecast]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Forecast_DW]]></condition>
          </dimension>
        </dimensions>
        <cube name="Store Calendar Week" />
      </query>
    </extract>
    <extract name="ex-DW [Status] Profit Centre Attribute Checksum" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <connection nameref="DW" />
      <query><![CDATA[SELECT 'ItemN' [#_Parameter_]
, 'Store Attribute Checksum' [Parameter]
, [Value] [#Value] 
from Status
where 1=1
and [Date] = (select max([Date]) from Status where [Activity] = 'Store Attribute Checksum')]]></query>
    </extract>
    <extract name="ex-DW [Status] Store Attribute Update" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <connection nameref="DW" />
      <query><![CDATA[create table #a (
[#_Parameter_] nvarchar(4000) NULL
, [Parameter] nvarchar(4000) NULL
, [#Value] nvarchar(4000) NULL
)
INSERT INTO #a ([#_Parameter_], [Parameter], [#Value]) 
select 'Item' [#_Parameter_]
, 'Store Attribute Change' [Parameter]
, case 
 when (select distinct value from status where 1=1 and convert(varchar(12),[date], 103) = convert(varchar(12), getdate(), 103) and Activity = 'Store Attribute Checksum') != (select distinct value from status where 1=1 and convert(varchar(12),[date], 103) = convert(varchar(12), dateadd(day, -1,getdate()), 103) and Activity = 'Store Attribute Checksum')
  then  'Update'
  else 'NoChange'
  end [#Value]
if (select distinct value from status where 1=1 and convert(varchar(12),[date], 103) = convert(varchar(12), getdate(), 103) and Activity = 'Store Attribute Checksum') != (select distinct value from status where 1=1 and convert(varchar(12),[date], 103) = convert(varchar(12), dateadd(day, -1,getdate()), 103) and Activity = 'Store Attribute Checksum')
BEGIN
    INSERT INTO #a ([#_Parameter_], [Parameter], [#Value])
    select 'ItemN' [#_Parameter_]
    , 'Store Attribute Change' [Parameter]
    , case 
      when (select distinct value from status where 1=1 and convert(varchar(12),[date], 103) = convert(varchar(12), getdate(), 103) and Activity = 'Store Attribute Checksum') != (select distinct value from status where 1=1 and convert(varchar(12),[date], 103) = convert(varchar(12), dateadd(day, -1,getdate()), 103) and Activity = 'Store Attribute Checksum') 
      then convert(int,(select DATEDIFF(dd,'19700101',convert(varchar(12),(select max([date]) from status where 1=1 and convert(varchar(12),[date], 103) = convert(varchar(12), dateadd(day, -1,getdate()), 103) and Activity = 'Store Attribute Checksum'), 112)) + 25569))
      end [#Value]
END

select * from #a
drop table #a

/*
select 'Item' [#_Parameter_]
, 'Store Attribute Update' [Parameter]
, case 
  when (select value from JedoxParameters where Parameter = 'Store Attribute Checksum') != (select value from status where 1=1 and convert(varchar(12),date, 103) = convert(varchar(12), dateadd(day, -1,getdate()), 103) and Activity = 'Store Attribute Checksum') then
    'Update'
  else 'NoChange'
  end [#Value]
*/]]></query>
    </extract>
    <extract modified="1602549892330" name="ex-Jedox [Cube]: Store Calendar" type="Cube" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query celltype="both" drillthrough="false" onlyBasisAsDefault="true" useRules="true" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="FYear">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${PrevYear}]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${CurrYear}]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${BudYear}]]></condition>
          </dimension>
          <dimension name="Period">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Base Periods]]></condition>
            <condition mode="onlyBases" operator="equal" type="deny"><![CDATA[Please select a period]]></condition>
          </dimension>
          <dimension name="Store Status">
            <condition mode="onlyBases" operator="like" type="accept"><![CDATA[Comp Type]]></condition>
          </dimension>
          <dimension name="Store">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Retail]]></condition>
          </dimension>
          <dimension name="Version">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Actual]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Budget]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Forecast]]></condition>
          </dimension>
        </dimensions>
        <cube name="Store Calendar" />
      </query>
    </extract>
    <extract name="ex-Jedox [Cube]: Parameters - All Paremters" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extract all parameters from the Parameters cube
These are used by jobs that follow in project [04-01] this as variables passed as parameters for BudYear, CurrYear, PrevYear, Forecast_MMM]]></comment>
      <connection nameref="Jedox" />
      <query celltype="both" drillthrough="false" onlyBasisAsDefault="true" useRules="true" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="#_Parameter_">
            <condition operator="equal" type="accept"><![CDATA[Item]]></condition>
            <condition operator="equal" type="accept"><![CDATA[ItemN]]></condition>
          </dimension>
        </dimensions>
        <cube name="#_Parameter" />
      </query>
    </extract>
    <extract name="ex-DW AP21 Store Polling Data (F_StorePollData)" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Combine the raw AP21 store polling data with the location details from the data warehouse.]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[/* Store Polling Starts Here */
/* ------------------------------- */
select left(Description,CHARINDEX('SalesDaily',Description)-1) Division
, cast(Value as DateTime) UpdateDate
into #dwupdate
from status where activity = 'SalesDaily Update Date'
and convert(varchar(12),date, 103) = convert(varchar(12),getdate(), 103)

select a.profCen, a.LocationCode
/* COALESCE(l.ProfCen,lm.ProfCen,lb.ProfCen) ProfCen
, COALESCE(l.LocationCode, lm.LocationCode,lb.LocationCode) LocationCode
*/
, COALESCE(l.Description, lm.Description, lb.Description) Description
, COALESCE(b.FinBusDivDesc, bm.FinBusDivDesc, bb.FinBusDivDesc) Division
, a.LAST_CONTACT
, a.LAST_SALE
, a.RetailDay
into #poll
--from ap21_store_polling_data a
from Store_Polling_Data a
left join PAS_DWH.dbo.location l on a.LocationCode = l.LocationCode
left join PAS_DWH_ME.ME.Location lm on a.LocationCode = lm.locationCode
left join PAS_DWH_BY.[BY].Location lb on a.LocationCode = lb.LocationCode
left join PAS_DWH.dbo.BusDiv b on l.BusDiv = b.BusDiv
left join PAS_DWH_ME.dbo.BusDiv bm on lm.BusDiv = bm.BusDiv
left join PAS_DWH_BY.dbo.BusDiv bb on lb.BusDiv = bb.BusDiv
where 1=1 
--and a.LAST_CONTACT > isnull(a.LAST_SALE,0)
order by 6

--select division, convert(varchar(20), UpdateDate, 113) DwUpdateTime from #dwupdate

/* Polling Checks Start Here */
/* ============================== */
select 'Stores With Sales but no Open Date' 'Check'
, p.ProfCen
, p.Description
, p.Division Division_Poll
, d.Division Division_DWUpdate
, convert(varchar(20), p.last_contact, 113) LastContact
, convert(varchar(20), p.last_sale, 113) LastSale
, convert(varchar(20), d.UpdateDate, 113) DwUpdateTime
, RetailDay
--, pc.CloseDate
into #poll_summary
from #poll p
left join #dwupdate d on p.Division = d.Division
left join ProfCen pc on p.ProfCen = pc.ProfCen
where 1=1
--and convert(varchar(20), p.last_sale, 113) > convert(varchar(20), d.UpdateDate, 113)
and pc.CloseDate is null
and pc.OpenDate is null
and p.last_sale is not null
and pc.ProCenTy <> 'RH'

union

select 'Stores Polling but No Sales' 'Check'
, p.ProfCen
, p.Description
, p.Division Division_Poll
, d.Division Division_DWUpdate
, convert(varchar(20), p.last_contact, 113) LastContact
, convert(varchar(20), p.last_sale, 113) LastSale
, convert(varchar(20), d.UpdateDate, 113) DwUpdateTime
, RetailDay
--, pc.CloseDate
from #poll p
left join #dwupdate d on p.Division = d.Division
left join ProfCen pc on p.ProfCen = pc.ProfCen
where 1=1
and pc.CloseDate is null
and pc.OpenDate is null
and p.last_sale is null
and p.last_contact is not null
and pc.ProCenTy <> 'RH'

union

select 'Stores With Sales After DW Update' 'Check'
, p.ProfCen
, p.Description
, p.Division Division_Poll
, d.Division Division_DWUpdate
, convert(varchar(20), p.last_contact, 113) LastContact
, convert(varchar(20), p.last_sale, 113) LastSale
, convert(varchar(20), d.UpdateDate, 113) DwUpdateTime
, RetailDay
--, pc.CloseDate
from #poll p
left join #dwupdate d on p.Division = d.Division
left join ProfCen pc on p.ProfCen = pc.ProfCen
where 1=1
and p.last_sale > d.UpdateDate
and pc.CloseDate is null
and pc.OpenDate is not null
and pc.ProCenTy <> 'RH'

union

select 'Stores Whose Last Sale is More Than 2 Days Ago' 'Check'
, p.ProfCen
, p.Description
, p.Division Division_Poll
, d.Division Division_DWUpdate
, convert(varchar(20), p.last_contact, 113) LastContact
, convert(varchar(20), p.last_sale, 113) LastSale
, convert(varchar(20), d.UpdateDate, 113) DwUpdateTime
, RetailDay
--, pc.CloseDate
from #poll p
left join #dwupdate d on p.Division = d.Division
left join ProfCen pc on p.ProfCen = pc.ProfCen
where 1=1
and pc.CloseDate is null
and pc.OpenDate is not null
and pc.ProCenTy <> 'RH'
and datediff(d, Last_Sale, Last_Contact) > 2

union

select 'Stores That Have Not Polled In the Previous 24 Hours' 'Check'
, p.ProfCen
, p.Description
, p.Division Division_Poll
, d.Division Division_DWUpdate
, convert(varchar(20), p.last_contact, 113) LastContact
, convert(varchar(20), p.last_sale, 113) LastSale
, convert(varchar(20), d.UpdateDate, 113) DwUpdateTime
, RetailDay
--, pc.CloseDate
from #poll p
left join #dwupdate d on p.Division = d.Division
left join ProfCen pc on p.ProfCen = pc.ProfCen
where 1=1
and pc.CloseDate is null
and pc.OpenDate is not null
and pc.ProCenTy <> 'RH'
and datediff(d, GetDate(), Last_Contact) >1


delete from [Fin].[F_StorePollData]
where 1=1
and  [RetailDay] in (select distinct RetailDay from #poll_summary)

INSERT INTO [Fin].[F_StorePollData]([Store], [RetailDay], [Store Polling Measure], [#Value]) 
select profcen Store, RetailDay, [Check] 'Store Polling Measure', count(*) '#Value'
from #poll_summary
group by profcen, RetailDay, [Check]
/* ================================== */
/* Polling Checks End Here */

drop table #dwupdate
drop table #poll
drop table #poll_summary
/* ---------------------- */
/* Store Pollng Ends Here*/

select Store, RetailDay, [Store Polling Measure], #Value from F_StorePollData]]></query>
    </extract>
    <extract name="ex-System [Cube]: User Properties" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox System Cubes" />
      <query celltype="only_string" drillthrough="false" onlyBasisAsDefault="true" useRules="false" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="#_USER_">
            <condition mode="onlyBases" operator="like" type="accept"><![CDATA[ONEPAS]]></condition>
            <condition mode="onlyBases" operator="like" type="accept"><![CDATA[fullname]]></condition>
          </dimension>
        </dimensions>
        <cube name="#_USER_USER_PROPERTIES" />
      </query>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Dim]: Days from PTime" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[2015-01-30 RKS Extracts the day and attribute data from the pTime table in PAS data warehouse PAS-DWH.]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[SELECT DISTINCT 'AllDays' LEVLE1 
  , CONVERT(VARCHAR(12),DimDate.CalendarDate, 112) LEVEL2 
  , CAST(DimDate.RetailYear AS VARCHAR(4) ) RetailYear 
  , CAST(FORMAT(DimDate.RetailPeriod,'\P00') AS VARCHAR(3)) RetailMonth 
  , DimDate.RetailPeriod RetailMonthValue 
  , CAST(FORMAT(DimDate.RetailWeek, 'WK00') AS VARCHAR(4)) RetailWeek 
  , CONVERT(VARCHAR(12), DimDate.CalendarDate, 113) 'DisplayDate' 
  , DimDate.RetailWeek RetailWeekValue 
  , CONVERT(VARCHAR(12),DimDate.RetailWeekStart, 112) RetailWeekStart
  , CONVERT(VARCHAR(12),DimDate.RetailWeekEnd, 112) RetailWeekEnd
  , DimDate.FinancialYear FinancialYear
  , CAST(FORMAT(DimDate.FinancialMonth,'\P00') AS VARCHAR(3)) FinancialPeriod
  , DimDate.FinancialMonth FinancialPeriodValue
  , LEFT(DATENAME(dw,DimDate.CalendarDate),3) DayOfWeek
  , CONVERT(VARCHAR(12),DimDate.PreviousDay, 112) Previous
  , CONVERT(VARCHAR(12),DimDate.NextDay, 112) Next
  , CONVERT(VARCHAR(12),DimDate.FinancialMonthEnd, 112) [Last Day Of Month]
  , CONVERT(VARCHAR(12),DimDate.CalendarDate, 103) [dd/mm/yyyy]
  , LEFT(DATENAME(M,DimDate.CalendarDate),3) + '-' + CAST(DATEPART(yy,DimDate.CalendarDate) AS VARCHAR(4)) MMMyyyy 
  , CAST(FORMAT(DATEPART(d,DimDate.CalendarDate),'00') AS VARCHAR(2)) + '-' + LEFT(DATENAME(M,DimDate.CalendarDate),3) + '-' + CAST(DATEPART(yy,DimDate.CalendarDate) AS VARCHAR(4)) ddMMMyyyy 
  , 
  CASE 
    WHEN DimDate.RetailPeriod = 1 
    THEN 'Forecast_000' 
    WHEN DimDate.RetailPeriod = 2 
    THEN 'Forecast_Jul' 
    WHEN DimDate.RetailPeriod = 3 
    THEN 'Forecast_Aug' 
    WHEN DimDate.RetailPeriod = 4 
    THEN 'Forecast_Sep' 
    WHEN DimDate.RetailPeriod = 5 
    THEN 'Forecast_Oct' 
    WHEN DimDate.RetailPeriod = 6 
    THEN 'Forecast_Nov' 
    WHEN DimDate.RetailPeriod = 7 
    THEN 'Forecast_Dec' 
    WHEN DimDate.RetailPeriod = 8 
    THEN 'Forecast_Jan' 
    WHEN DimDate.RetailPeriod = 9 
    THEN 'Forecast_Feb' 
    WHEN DimDate.RetailPeriod = 10 
    THEN 'Forecast_Mar' 
    WHEN DimDate.RetailPeriod = 11 
    THEN 'Forecast_Apr' 
    WHEN DimDate.RetailPeriod = 12 
    THEN 'Forecast_May' 
  END [Retail Forecast Version]
  , DATEDIFF(dd,'19000101',CONVERT(VARCHAR(12), CalendarDate, 112)) +2 [ExcelDate]    
FROM dbo.DimDate 
WHERE calendardate > '30-Jun-2019' 
ORDER BY 2]]></query>
      <alias_map>
        <alias origin="LEVLE1">1</alias>
        <alias origin="LEVEL2">2</alias>
        <alias origin="RetailYear">3</alias>
        <alias origin="RetailMonth">4</alias>
        <alias origin="RetailMonthValue">5</alias>
        <alias origin="RetailWeek">6</alias>
        <alias origin="DisplayDate">7</alias>
        <alias origin="RetailWeekValue">8</alias>
        <alias origin="RetailWeekStart">9</alias>
        <alias origin="RetailWeekEnd">10</alias>
        <alias origin="FinancialYear">11</alias>
        <alias origin="FinancialPeriod">12</alias>
        <alias origin="FinancialPeriodValue">13</alias>
        <alias origin="DayOfWeek">14</alias>
        <alias origin="Previous">15</alias>
        <alias origin="Next">16</alias>
        <alias origin="Last Day Of Month">17</alias>
        <alias origin="dd/mm/yyyy">18</alias>
        <alias origin="MMMyyyy">19</alias>
        <alias origin="ddMMMyyyy">20</alias>
        <alias origin="Retail Forecast Version">21</alias>
        <alias origin="ExcelDate">22</alias>
      </alias_map>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Dim]: RetailDays from PTime" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[2015-01-30 RKS Extracts the day and attribute data from the pTime table in PAS data warehouse PAS-DWH.]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[SELECT DISTINCT 'AllRetailYears' LEVLE1
  , CAST(DimDate.RetailYear AS VARCHAR(4))+'R' LEVEL2
  , CAST(DimDate.RetailYear AS VARCHAR(4))+ '_H' +CAST(DimDate.RetailHalf AS VARCHAR(4)) +'R'  LEVEL3
  , CAST(DimDate.RetailYear AS VARCHAR(4)) +'_' + CAST(FORMAT(DimDate.RetailPeriod,'\P00') AS VARCHAR(3))  + 'R' LEVEL4
  , CONVERT(VARCHAR(12),DimDate.CalendarDate, 112) LEVEL5
FROM dbo.DimDate 
WHERE calendardate > '30-Jun-2019' 
ORDER BY 5]]></query>
      <alias_map>
        <alias origin="LEVLE1">1</alias>
        <alias origin="LEVEL2">2</alias>
        <alias origin="LEVEL3">3</alias>
        <alias origin="LEVEL4">4</alias>
        <alias origin="LEVEL5">5</alias>
      </alias_map>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Dim]: FinancialDays from PTime" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[2015-01-30 RKS Extracts the day and attribute data from the pTime table in PAS data warehouse PAS-DWH.]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[SELECT DISTINCT 'AllFinancialYears' LEVLE1
  , CAST(DimDate.FinancialYear AS VARCHAR(4)) LEVEL2
  , CAST(DimDate.FinancialYear AS VARCHAR(4)) +'_' + CAST(FORMAT(DimDate.FinancialMonth,'\P00') AS VARCHAR(3)) LEVEL3
  , CONVERT(VARCHAR(12),DimDate.CalendarDate, 112) LEVEL4 
FROM dbo.DimDate 
WHERE calendardate > '30-Jun-2019' 
ORDER BY 4]]></query>
      <alias_map>
        <alias origin="LEVLE1">1</alias>
        <alias origin="LEVEL2">2</alias>
        <alias origin="LEVEL3">3</alias>
        <alias origin="LEVEL4">4</alias>
      </alias_map>
    </extract>
    <extract name="ex-Jedox [Dim]: Accounts - Stat P&amp;L" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query>
        <dimension name="Account">
          <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Stat PL Profit / (loss) for the Year]]></condition>
        </dimension>
      </query>
      <attributesMode>none</attributesMode>
    </extract>
    <extract name="ex-Jedox [Dim]: Accounts - P&amp;L" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query>
        <dimension name="Account">
          <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[P&L]]></condition>
        </dimension>
      </query>
      <attributesMode>none</attributesMode>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Dim] Account - Stat PandL Check" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extracts accounts that are in the P&L but not the Stat P&L]]></comment>
      <connection nameref="DW Raw" />
      <query><![CDATA[select account from JEDOX_STAT_PANDL_CHECK where Source = 'PandL'
except
select account from JEDOX_STAT_PANDL_CHECK where Source = 'Stat_PandL']]></query>
    </extract>
    <extract name="ex-Jedox [Cube]: Stat PandL Balance Check" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query celltype="both" drillthrough="false" onlyBasisAsDefault="false" useRules="false" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="Currency">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[AUD]]></condition>
          </dimension>
          <dimension name="FYear">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${CurrYear}]]></condition>
          </dimension>
          <dimension name="Period">
            <condition mode="onlyRoots" operator="equal" type="accept"><![CDATA[Full Year]]></condition>
          </dimension>
          <dimension name="Version">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Actual]]></condition>
          </dimension>
          <dimension name="Business Division">
            <condition mode="onlyRoots" operator="equal" type="accept"><![CDATA[All Business Divisions]]></condition>
          </dimension>
          <dimension name="Company">
            <condition mode="onlyRoots" operator="equal" type="accept"><![CDATA[PAS Group Cons]]></condition>
          </dimension>
          <dimension name="Profit-Cost Centre">
            <condition mode="onlyRoots" operator="equal" type="accept"><![CDATA[All Profit-Cost Centres]]></condition>
          </dimension>
          <dimension name="Account">
            <condition mode="onlyRoots" operator="equal" type="accept"><![CDATA[P&L Check]]></condition>
          </dimension>
        </dimensions>
        <cube name="Financials" />
      </query>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Store Calendar - Week] Store Status Dates" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extracts the store status dates by both period and week so that only 1 query is required (and maintained).]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[/* =============  Actual Start ============ */
select distinct 'Actual' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'StoreOpenDate' 'Store Status'
, vpc.OpenDate '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.OpenDate is not null
--
union -- Actual CloseDate
--
select distinct 'Actual' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'StoreCloseDate' 'Store Status'
, vpc.CloseDate '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.CloseDate is not null
--
union --Actual RefStartDate
--
select distinct 'Actual' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'RefurbStartDate' 'Store Status'
, vpc.RefStartDate '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.RefStartDate is not null
--
union -- Actual RefEndDate
--
select distinct 'Actual' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'RefurbEndDate' 'Store Status'
, vpc.RefEndDate '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.RefEndDate is not null
/* =============  Actual End ============ */
union
/* =============  Budget Start ============ */
select distinct 'Budget' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'StoreOpenDate' 'Store Status'
, case when p.FinYear <= (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('CurrYearETL')) 
    then vpc.BOpenDateCY 
    else vpc.BOpenDate
 end '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
--
union -- Budget CloseDate
--
select distinct 'Budget' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'StoreCloseDate' 'Store Status'
, case when p.FinYear <= (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('CurrYearETL')) 
    then vpc.BCloseDateCY 
    else vpc.BCloseDate
  end '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))

--
union -- Budget RefStartDate
--
select distinct 'Budget' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'RefurbStartDate' 'Store Status'
, case when p.FinYear <= (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('CurrYearETL')) 
    then vpc.BRefStartDateCY
    else vpc.BRefStartDate
  end '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.RefStartDate is not null
--
union -- Budget RefEndDate
--
select distinct 'Budget' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'RefurbEndDate' 'Store Status'
, case when p.FinYear <= (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('CurrYearETL')) 
    then vpc.BRefEndDateCY
    else vpc.BRefEndDate
  end '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.RefEndDate is not null
/* =============  Budget End ============ */
union
/* =============  Forecast Start ============ */
select distinct 'Forecast' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'StoreOpenDate' 'Store Status'
, vpc.FOpenDate '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.FOpenDate is not null
--
union --Forecast CloseDate
--
select distinct 'Forecast' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'StoreCloseDate' 'Store Status'
, vpc.FCloseDate '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.FCloseDate is not null
--
union -- Forecast RefStartDate
--
select distinct 'Forecast' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'RefurbStartDate' 'Store Status'
, vpc.FRefStartDate '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.RefStartDate is not null
--
union -- Forecast RefEndDate
--
select distinct 'Forecast' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'RefurbEndDate' 'Store Status'
, vpc.FRefEndDate '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.RefEndDate is not null
/* =============  Forecast End ============ */

-- Extract for Serial Dates
union
/* =============  Actual Start ============ */
select distinct 'Actual' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'StoreOpenDateS' 'Store Status'
, DATEDIFF(dd,'19700101',convert(varchar(12), vpc.OpenDate, 112)) '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.OpenDate is not null
/* =============  Actual End ============ */
union
/* =============  Budget Start ============ */
select distinct 'Budget' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'StoreOpenDateS' 'Store Status'
, case when p.FinYear <= (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('CurrYearETL')) 
    then DATEDIFF(dd,'19700101',convert(varchar(12), vpc.BOpenDateCY, 112))
    else DATEDIFF(dd,'19700101',convert(varchar(12), vpc.BOpenDate, 112))
 end '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.BOpenDateCY is not null
and vpc.BOpenDate is not null
/* =============  Budget End ============ */
union
/* =============  Forecast Start ============ */
select distinct 'Forecast' 'Version'
, p.FinYear 'Year'
, FORMAT(p.FinMonth, '#P00') as [Period]
, FORMAT(CONVERT(int,p.RetWeek), 'WK00') AS [Week]
, vpc.profcen 'Store'
, 'StoreOpenDateS' 'Store Status'
, DATEDIFF(dd,'19700101',convert(varchar(12), vpc.FOpenDate, 112)) '#Value'
from vprofcen vpc
, ptime p
where 1=1
and p.FinMonth in (select distinct finmonth  from ptime)
and vpc.ProCenTy in ('RT','CO','OU','RH','EC')
and p.finyear between (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('PrevYearETL')) and (select Value from PAS_DWH.fin.JedoxParameters where Parameter in ('NextYearETL'))
and vpc.FOpenDate is not null
order by Year,Period,Week, Store, Version, 'Store Status' desc
/* =============  Forecast End ============ */]]></query>
    </extract>
    <extract modified="1602549892330" name="Duplicate of ex-Jedox [Cube]: Store Calendar Week" type="Cube" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query celltype="both" drillthrough="false" onlyBasisAsDefault="true" useRules="true" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="FYear">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${PrevYear}]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${CurrYear}]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[${BudYear}]]></condition>
          </dimension>
          <dimension name="Week">
            <condition mode="onlyBases" operator="like" type="accept"><![CDATA[Week Base Periods]]></condition>
            <condition mode="onlyBases" operator="equal" type="deny"><![CDATA[Please select a week]]></condition>
          </dimension>
          <dimension name="Store Status">
            <condition mode="onlyBases" operator="like" type="accept"><![CDATA[Comp Type]]></condition>
          </dimension>
          <dimension name="Store">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[1035]]></condition>
          </dimension>
          <dimension name="Version">
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Actual]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Budget]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Forecast]]></condition>
            <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Forecast_DW]]></condition>
          </dimension>
        </dimensions>
        <cube name="Store Calendar Week" />
      </query>
    </extract>
    <extract modified="1602549892330" name="zzProfCenTest" type="Dimension" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query>
        <dimension name="Region">
          <condition operator="equal" type="deny"><![CDATA[Please select a region]]></condition>
        </dimension>
      </query>
      <attributesMode>none</attributesMode>
    </extract>
    <extract modified="1602549892330" name="ex-Jedox Review Reporting Concessions" type="Dimension" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query>
        <dimension name="Profit-Cost Centre">
          <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Review - Concession]]></condition>
        </dimension>
      </query>
      <attributesMode>none</attributesMode>
    </extract>
    <extract modified="1602549892330" name="ex-Jedox Review Profit Centre Concessions" type="Dimension" modifiedBy="ONEPAS\richards">
      <connection nameref="Jedox" />
      <query>
        <dimension name="Profit-Cost Centre">
          <condition mode="onlyBases" operator="equal" type="accept"><![CDATA[Review - Concessions]]></condition>
        </dimension>
      </query>
      <attributesMode>none</attributesMode>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Dim]: Review Profit Centre Concession Check" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extracts any Review concession profit centres that are not mapped into the Review concession reporting hierarchy]]></comment>
      <connection nameref="DW Raw" />
      <query><![CDATA[SELECT
	[level1]
FROM [DataWarehouseRawData].[dbo].[Jedox_review_profitcentre_concessions]
WHERE NOT EXISTS (SELECT
		*
	FROM DataWarehouseRawData.dbo.Jedox_review_reporting_concessions)]]></query>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Attr] ETL Financial Period" type="Relational" modifiedBy="ONEPAS\richards">
      <connection nameref="DW" />
      <query><![CDATA[select 'Item' [#_Parameter_]
, 'Current Period ETL'  Parameter
,'P' + Format(Convert(Int,SysConfiguration.ConfigurationValue), '00')  [#Value]
from DataWarehouse.dbo.SysConfiguration 
where SysConfiguration.ConfigurationKey = 'ReportingFinancialMonth']]></query>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Dim]: Days - PayDates for Payroll Cube" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[2015-01-30 RKS Extracts the day and attribute data from the pTime table in PAS data warehouse PAS-DWH.]]></comment>
      <connection nameref="DW" />
      <query><![CDATA[IF OBJECT_ID('tempdb..#Dates') IS NOT NULL DROP TABLE #Dates
IF OBJECT_ID('tempdb..#PayDates') IS NOT NULL DROP TABLE #PayDates

DECLARE @PayDateCursor CURSOR
DECLARE @LEVEL1 VARCHAR(30), @LEVEL2 VARCHAR(20), @LEVEL3 VARCHAR(15), @PayDate VARCHAR(12), @Day VARCHAR(12)
DECLARE @Results TABLE (LEVEL1 VARCHAR(30), LEVEL2 VARCHAR(20), LEVEL3 VARCHAR(15) ,PayDate VARCHAR(12) ,Days VARCHAR(12))


SELECT DISTINCT p.RetailWeek, p.RetailWeekEnd, p.CalendarDate
INTO #PayDates
FROM dbo.DimDate p 
WHERE p.RetailWeekEnd > '17-Jun-2018'
order by 2

BEGIN
  SET @PayDateCursor = CURSOR
  FOR
    SELECT DISTINCT RetailWeekend
    FROM #PayDates
    OPEN @PayDateCursor
    FETCH NEXT FROM @PayDateCursor INTO @PayDate
    WHILE @@FETCH_STATUS = 0 

    BEGIN
      INSERT INTO @Results
      select 'Pay Period Consolidations'
      ,''
	  ,''
      ,@PayDate 
      ,CalendarDate 
      from #PayDates PayDates
      where paydates.CalendarDate BETWEEN DATEADD(DAY, -13, @PayDate) AND @PayDate
      ORDER BY 4,5
      FETCH NEXT FROM @PayDateCursor INTO @PayDate
    END
    CLOSE @PayDateCursor
    DEALLOCATE @PayDateCursor
END

UPDATE Results
SET LEVEL2 = CASE 
    WHEN RetailWeek % 2 = 0  AND (DimDate.RetailYear < 2020 OR DimDate.RetailYear > 2024)
    THEN 'RE Consolidations' 
    ELSE 'ME Consolidations' 
  END
, LEVEL3 = CASE 
    WHEN RetailWeek % 2 = 0  AND (DimDate.RetailYear < 2020 OR DimDate.RetailYear > 2024)
    THEN CONVERT(VARCHAR(12), CONVERT(DATE,PayDate), 112) + 'RE' 
    ELSE CONVERT(VARCHAR(12), CONVERT(DATE,PayDate), 112) + 'ME' 
  END
FROM @Results Results
INNER JOIN DimDate 
ON DimDate.RetailWeekEnd = Results.PayDate
WHERE (DimDate.RetailYear < 2020 OR DimDate.RetailYear > 2024)

UPDATE Results
SET LEVEL2 = CASE 
    WHEN RetailWeek % 2 = 0 AND (DimDate.RetailYear BETWEEN 2020 AND 2024)
    THEN 'ME Consolidations' 
    ELSE 'RE Consolidations' 
  END
, LEVEL3 = CASE 
    WHEN RetailWeek % 2 = 0   AND (DimDate.RetailYear BETWEEN 2020 AND 2024)
    THEN CONVERT(VARCHAR(12), CONVERT(DATE,PayDate), 112) + 'ME' 
    ELSE CONVERT(VARCHAR(12), CONVERT(DATE,PayDate), 112) + 'RE' 
  END
FROM @Results Results
INNER JOIN DimDate 
ON DimDate.RetailWeekEnd = Results.PayDate
WHERE  DimDate.RetailYear BETWEEN 2020 AND 2024


--SELECT DISTINCT LEVEL1, LEVEL2, LEVEL3, RetailWeek, DimDate.RetailYear
--FROM @Results Results
--INNER JOIN DimDate 
--ON DimDate.RetailWeekEnd = Results.PayDate

select LEVEL1, LEVEL2, LEVEL3,CONVERT(VARCHAR(12), CONVERT(DATE,Days), 112) LEVLE4
from @Results
order by 2,3,4]]></query>
      <alias_map>
        <alias origin="LEVEL1">1</alias>
        <alias origin="LEVEL2">2</alias>
        <alias origin="LEVEL3">3</alias>
        <alias origin="LEVLE4">4</alias>
      </alias_map>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Attr] ETL Financial Year" type="Relational" modifiedBy="ONEPAS\richards">
      <connection nameref="DW" />
      <query><![CDATA[select 'Item' [#_Parameter_]
, 'Financial Year ETL'  Parameter
,Format(Convert(Int,SysConfiguration.ConfigurationValue), '0000')  [#Value]
from DataWarehouse.dbo.SysConfiguration 
where SysConfiguration.ConfigurationKey = 'ReportingFinancialYear']]></query>
    </extract>
    <extract modified="1602549892330" name="ex-DW [Attr] Retail ETL Forecast Version" type="Relational" modifiedBy="ONEPAS\richards">
      <connection nameref="DW" />
      <query><![CDATA[SELECT 'Item' [#_Parameter_]
,'Retail ETL Forecast' [Parameter]
,FORMAT(DimDate.RetailWeek,'WK00') Week
FROM DimDate
WHERE DimDate.CalendarDate = CAST(GETDATE() AS DATE)]]></query>
      <alias_map>
        <alias origin="#_Parameter_">1</alias>
        <alias origin="Parameter">2</alias>
        <alias origin="Week">3</alias>
      </alias_map>
    </extract>
    <extract modified="1602549892330" name="ex-Jedox [Cube]: Parameters - BudYear Only" type="Cube" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Extract all parameters from the Parameters cube
These are used by jobs that follow in project [04-01] this as variables passed as parameters for BudYear, CurrYear, PrevYear, Forecast_MMM]]></comment>
      <connection nameref="Jedox" />
      <query celltype="both" drillthrough="false" onlyBasisAsDefault="true" useRules="true" zeroSuppressionType="excludeEmpty">
        <dimensions>
          <dimension name="#_Parameter_">
            <condition operator="equal" type="accept"><![CDATA[Item]]></condition>
            <condition operator="equal" type="accept"><![CDATA[ItemN]]></condition>
          </dimension>
          <dimension name="Parameter">
            <condition mode="onlyBases" operator="inAlphaRange" type="accept"><![CDATA[[BudYear,BudYearETL]]]></condition>
          </dimension>
        </dimensions>
        <cube name="#_Parameter" />
      </query>
    </extract>
  </extracts>
  <transforms>
    <transform name="tf-FT [Atr]: Current Period" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the Current Period in the parameter cube to the Current Period attribute in the Period dimension]]></comment>
      <sources>
        <source nameref="tf-TJ [Dim]: Period to Current Period" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="level1">
            <input nameref="level1" />
          </coordinate>
          <coordinate name="Current Period">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-TJ [Dim]: Period to Current Period" type="TableJoin" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Joins the extract of the #_Parameter Current Period with the extract of base periods from the Period Dimension.

The result is the single member whose Current Period attribute in the period dimension will be updated.]]></comment>
      <sources>
        <source nameref="ex-Jedox [Attr]: Parameters (Period)" />
        <source nameref="ex-Jedox [Dim]: Period" />
      </sources>
      <joins>
        <join type="inner">
          <left nameref="ex-Jedox [Attr]: Parameters (Period)">
            <key nameref="#Value" />
          </left>
          <right nameref="ex-Jedox [Dim]: Period">
            <key nameref="level1" />
          </right>
        </join>
      </joins>
    </transform>
    <transform name="tf-FT [Atr]: Current Period Attribute Clear" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the period to a blank Current Period value.
Used to clear out the Current Period attribute in the period dimension.]]></comment>
      <sources>
        <source nameref="ex-Jedox [Dim]: Period" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="level1">
            <input nameref="level1" />
          </coordinate>
          <coordinate name="Current Period">
            <input constant=" " />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-TJ [Dim]: Week to Current Week" type="TableJoin" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Joins the extract of the #_Parameter Current Period with the extract of base periods from the Period Dimension.

The result is the single member whose Current Period attribute in the period dimension will be updated.]]></comment>
      <sources>
        <source nameref="ex-Jedox [Attr]: Parameters (Week)" />
        <source nameref="ex-Jedox [Dim]: Week" />
      </sources>
      <joins>
        <join type="inner">
          <left nameref="ex-Jedox [Attr]: Parameters (Week)">
            <key nameref="#Value" />
          </left>
          <right nameref="ex-Jedox [Dim]: Week">
            <key nameref="level1" />
          </right>
        </join>
      </joins>
    </transform>
    <transform name="tf-FT [Atr]: Current Week" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the Current Period in the parameter cube to the Current Period attribute in the Period dimension]]></comment>
      <sources>
        <source nameref="tf-TJ [Dim]: Week to Current Week" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="level1">
            <input nameref="level1" />
          </coordinate>
          <coordinate name="Current Week">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-FT [Atr]: Current Week Attribute Clear" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the period to a blank Current Period value.
Used to clear out the Current Period attribute in the period dimension.]]></comment>
      <sources>
        <source nameref="ex-Jedox [Dim]: Week" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="level1">
            <input nameref="level1" />
          </coordinate>
          <coordinate name="Current Week">
            <input constant=" " />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-FT [Atr]: Current Year" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the Current Period in the parameter cube to the Current Period attribute in the Period dimension]]></comment>
      <sources>
        <source nameref="tf-TJ [Dim]: Year to Current Year" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="level1">
            <input nameref="level1" />
          </coordinate>
          <coordinate name="Current Year">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-TJ [Dim]: Year to Current Year" type="TableJoin" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Joins the extract of the #_Parameter Current Period with the extract of base periods from the Period Dimension.

The result is the single member whose Current Period attribute in the period dimension will be updated.]]></comment>
      <sources>
        <source nameref="ex-Jedox [Attr]: Parameters (Year)" />
        <source nameref="ex-Jedox [Dim]: Year" />
      </sources>
      <joins>
        <join type="inner">
          <left nameref="ex-Jedox [Attr]: Parameters (Year)">
            <key nameref="#Value" />
          </left>
          <right nameref="ex-Jedox [Dim]: Year">
            <key nameref="level1" />
          </right>
        </join>
      </joins>
    </transform>
    <transform name="tf-FT [Atr]: Current Year Attribute Clear" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the period to a blank Current Period value.
Used to clear out the Current Period attribute in the period dimension.]]></comment>
      <sources>
        <source nameref="ex-Jedox [Dim]: Year" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="level1">
            <input nameref="level1" />
          </coordinate>
          <coordinate name="Current Year">
            <input constant=" " />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-FT [Atr]: Current Week for Parameter Update" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the current period based on date from the DW that will be used to update the Parameter cube.]]></comment>
      <sources>
        <source nameref="ex-DW [Dim] Week - Current Retail Week" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Attr#_Parameter_">
            <input nameref="#_Parameter_" />
          </coordinate>
          <coordinate name="AttrVersion">
            <input nameref="Parameter" />
          </coordinate>
          <coordinate name="Attr#Value">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-FT [Atr]: Current Week for Current Week Text File" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the current period based on date from the DW that will be used to update the Parameter cube.]]></comment>
      <sources>
        <source nameref="ex-DW [Dim] Week - Current Retail Week" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Attr#Value">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-FT [Cube]: Parameter Cube Export for File" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Formats the #_Parameter cube extract for use in an email.]]></comment>
      <sources>
        <source nameref="ex-Jedox [Cube]: Parameters - All Paremters" />
      </sources>
      <functions>
        <function name="WholeNumber" type="NumberFormat">
          <inputs>
            <input nameref="#Value" />
          </inputs>
          <parameters>
            <pattern>0</pattern>
          </parameters>
        </function>
      </functions>
      <target>
        <coordinates>
          <coordinate name="Parameter">
            <input nameref="Parameter" />
          </coordinate>
          <coordinate name="Value">
            <input nameref="WholeNumber" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="Convert Actual to Forecast" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex FY14 Actual For Copy to Forecast" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Version">
            <input constant="Forecast" />
          </coordinate>
          <coordinate name="FYear">
            <input nameref="FYear" />
          </coordinate>
          <coordinate name="Week">
            <input nameref="Week" />
          </coordinate>
          <coordinate name="Currency">
            <input nameref="Currency" />
          </coordinate>
          <coordinate name="Region">
            <input nameref="Region" />
          </coordinate>
          <coordinate name="Store">
            <input nameref="Store" />
          </coordinate>
          <coordinate name="Comp Type">
            <input nameref="Comp Type" />
          </coordinate>
          <coordinate name="Weekly Retail Measure">
            <input nameref="Weekly Retail Measure" />
          </coordinate>
          <coordinate name="#Value">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform modified="1602549892330" name="tf-TD [Cube]: Store Calendar Week - (Comp Type Export to DW)" type="TableDenormalization" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-Jedox [Cube]: Store Calendar Week" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Load Type">
            <input constant="StoreCalendarWeek" />
          </coordinate>
          <coordinate name="Version">
            <input nameref="Version" />
          </coordinate>
          <coordinate name="FYear">
            <input nameref="FYear" />
          </coordinate>
          <coordinate name="TimePeriod">
            <input nameref="Week" />
          </coordinate>
          <coordinate name="Store">
            <input nameref="Store" />
          </coordinate>
        </coordinates>
        <measures denormalize="Store Status">
          <measure aggregate="first" name="Comp Type CY" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="last" name="Comp Type LY" type="text">
            <input nameref="#Value" />
          </measure>
        </measures>
      </target>
    </transform>
    <transform name="tf-TD [Cube]: Store Calendar - (Comp Type Export to DW)" type="TableDenormalization" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-Jedox [Cube]: Store Calendar" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Load Type">
            <input constant="StoreCalendar" />
          </coordinate>
          <coordinate name="Version">
            <input nameref="Version" />
          </coordinate>
          <coordinate name="FYear">
            <input nameref="FYear" />
          </coordinate>
          <coordinate name="TimePeriod">
            <input nameref="Period" />
          </coordinate>
          <coordinate name="Store">
            <input nameref="Store" />
          </coordinate>
        </coordinates>
        <measures denormalize="Store Status">
          <measure aggregate="first" name="Comp Type CY" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="last" name="Comp Type LY" type="text">
            <input nameref="#Value" />
          </measure>
        </measures>
      </target>
    </transform>
    <transform name="tf-TD [Cube]: Parameters - (Parameter Export to DW)" type="TableDenormalization" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-Jedox [Cube]: Parameters - All Paremters" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Parameter">
            <input nameref="Parameter" />
          </coordinate>
        </coordinates>
        <measures denormalize="#_Parameter_">
          <measure aggregate="first" name="Item" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="last" name="ItemN" type="text">
            <input nameref="#Value" />
          </measure>
        </measures>
      </target>
    </transform>
    <transform name="tf-FT [Cube]: Parameter Cube Export for DW" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="tf-TD [Cube]: Parameters - (Parameter Export to DW)" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Parameter">
            <input nameref="Parameter" />
          </coordinate>
          <coordinate name="Value">
            <input nameref="Item" />
          </coordinate>
          <coordinate name="ValueN">
            <input nameref="ItemN" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="New Transform" type="TableDenormalization" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-System [Cube]: User Properties" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="UserParameters">
            <input nameref="#_USER_" />
          </coordinate>
        </coordinates>
        <measures denormalize="#_USER_PROPERTIES_">
          <measure aggregate="max" name="fullName" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="max" name="description" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="max" name="recent" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="max" name="prefs" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="max" name="inactive" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="max" name="email" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="max" name="licenses" type="text">
            <input nameref="#Value" />
          </measure>
        </measures>
      </target>
    </transform>
    <transform name="tf-FT [Dim] : RetailDay" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Groovy scripts developed by Naked Data

This transform calculates various attribute values.]]></comment>
      <sources>
        <source nameref="ex-DW [Dim]: RetailDays from PTime" />
      </sources>
      <functions>
        <function name="prevDay" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.DATE, -1);
yesterday = tomorrowCal.time;
String sYear = yesterday.getAt(Calendar.YEAR);
String sDate = yesterday.getAt(Calendar.DATE);
String sNumMonth = yesterday.getAt(Calendar.MONTH)+1;
String sDay = (sDate.toInteger()<10)?"0"+(sDate.toInteger()):(sDate.toInteger());
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
String sLoadYear = (sMonth.toInteger()<7)?sYear:sYear.toInteger()+1;
sTemp1 = Date.parse( 'MM', sNumMonth );
sTemp2 = sTemp1.toString();
Mth = sTemp2.substring(4,7);
FYr = "FY-"+sLoadYear;
prevDay = sYear+sMonth+sDay;]]></script>
            <type><![CDATA[String]]></type>
          </parameters>
        </function>
        <function name="nextDay" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.DATE, 1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
String sDate = tomorrow.getAt(Calendar.DATE);
String sNumMonth = tomorrow.getAt(Calendar.MONTH)+1;
String sDay = (sDate.toInteger()<10)?"0"+(sDate.toInteger()):(sDate.toInteger());
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
String sLoadYear = (sMonth.toInteger()<7)?sYear:sYear.toInteger()+1;
sTemp1 = Date.parse( 'MM', sNumMonth );
sTemp2 = sTemp1.toString();
Mth = sTemp2.substring(4,7);
FYr = "FY-"+sLoadYear;
nextDay = sYear+sMonth+sDay;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="lastDay" type="Groovy">
          <inputs>
            <input nameref="Day" type="String" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
String sYear = tomorrowCal.getAt(Calendar.YEAR);
String sDate = tomorrowCal.getAt(Calendar.DATE);
String sNumMonth = tomorrowCal.getAt(Calendar.MONTH)+1;
int lastDayOfMonth = tomorrowCal.getActualMaximum(Calendar.DAY_OF_MONTH);
String sDay = (lastDayOfMonth<10)?"0"+(lastDayOfMonth):(lastDayOfMonth);
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
String sLoadYear = (sMonth.toInteger()<7)?sYear:sYear.toInteger()+1;
sTemp1 = Date.parse( 'MM', sNumMonth );
sTemp2 = sTemp1.toString();
Mth = sTemp2.substring(4,7);
FYr = "FY-"+sLoadYear;
lastDay = sYear+sMonth+sDay;]]></script>
            <type><![CDATA[String]]></type>
          </parameters>
        </function>
        <function name="prevMonth" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.MONTH, -1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
String sNumMonth = tomorrow.getAt(Calendar.MONTH)+1;
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
prevMonth = sYear+sMonth;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="nextMonth" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.MONTH, 1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
String sNumMonth = tomorrow.getAt(Calendar.MONTH)+1;
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
nextMonth = sYear+sMonth;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="nextYear" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.YEAR, 1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
nextYear = sYear;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="prevYear" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.YEAR, -1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
prevYear = sYear;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="ddMMMyyyy" type="DateFormat">
          <inputs>
            <input nameref="Day" />
          </inputs>
          <parameters>
            <sourceformat>yyyyMMdd</sourceformat>
            <targetformat>dd-MMM-yyyy</targetformat>
            <language>en</language>
          </parameters>
        </function>
        <function name="MMMyyyy" type="DateFormat">
          <inputs>
            <input nameref="Day" />
          </inputs>
          <parameters>
            <sourceformat>yyyyMMdd</sourceformat>
            <targetformat>MMM-yyyy</targetformat>
            <language>en</language>
          </parameters>
        </function>
        <function name="dd/mm/yyyy" type="DateFormat">
          <inputs>
            <input nameref="Day" />
          </inputs>
          <parameters>
            <sourceformat>yyyyMMdd</sourceformat>
            <targetformat>dd/MM/yyyy</targetformat>
            <language>en</language>
          </parameters>
        </function>
      </functions>
    </transform>
    <transform modified="1602549892330" name="tf-FH [Dim] : Day" type="TreeFH" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Brings in the attributes associated with each day.]]></comment>
      <sources>
        <source nameref="ex-DW [Dim]: Days from PTime" />
      </sources>
      <target type="numeric">
        <attributes>
          <attribute name="RetailYear" type="string" />
          <attribute name="RetailMonth" type="string" />
          <attribute name="RetailMonthValue" type="string" />
          <attribute name="RetailWeek" type="string" />
          <attribute name="DisplayDate" type="string" />
          <attribute name="RetailWeekValue" type="numeric" />
          <attribute name="RetailWeekStart" type="string" />
          <attribute name="RetailWeekEnd" type="string" />
          <attribute name="FinancialYear" type="string" />
          <attribute name="FinancialPeriod" type="string" />
          <attribute name="FinancialPeriodValue" type="string" />
          <attribute name="DayOfWeek" type="string" />
          <attribute name="Previous" type="string" />
          <attribute name="Next" type="string" />
          <attribute name="Last Day Of Month" type="string" />
          <attribute name="dd/mm/yyyy" type="string" />
          <attribute name="MMMyyyy" type="string" />
          <attribute name="ddMMMyyyy" type="string" />
          <attribute name="Retail Forecast Version" type="string" />
          <attribute name="ExcelDate" type="numeric" />
        </attributes>
        <levels>
          <level>
            <input nameref="LEVLE1" />
          </level>
          <level>
            <input nameref="LEVEL2" />
            <attributes>
              <attribute name="RetailYear">
                <input nameref="RetailYear" />
              </attribute>
              <attribute name="RetailMonth">
                <input nameref="RetailMonth" />
              </attribute>
              <attribute name="RetailMonthValue">
                <input nameref="RetailMonthValue" />
              </attribute>
              <attribute name="RetailWeek">
                <input nameref="RetailWeek" />
              </attribute>
              <attribute name="DisplayDate">
                <input nameref="DisplayDate" />
              </attribute>
              <attribute name="RetailWeekValue">
                <input nameref="RetailWeekValue" />
              </attribute>
              <attribute name="RetailWeekStart">
                <input nameref="RetailWeekStart" />
              </attribute>
              <attribute name="RetailWeekEnd">
                <input nameref="RetailWeekEnd" />
              </attribute>
              <attribute name="FinancialYear">
                <input nameref="FinancialYear" />
              </attribute>
              <attribute name="FinancialPeriod">
                <input nameref="FinancialPeriod" />
              </attribute>
              <attribute name="FinancialPeriodValue">
                <input nameref="FinancialPeriodValue" />
              </attribute>
              <attribute name="DayOfWeek">
                <input nameref="DayOfWeek" />
              </attribute>
              <attribute name="Previous">
                <input nameref="Previous" />
              </attribute>
              <attribute name="Next">
                <input nameref="Next" />
              </attribute>
              <attribute name="Last Day Of Month">
                <input nameref="Last Day Of Month" />
              </attribute>
              <attribute name="dd/mm/yyyy">
                <input nameref="dd/mm/yyyy" />
              </attribute>
              <attribute name="MMMyyyy">
                <input nameref="MMMyyyy" />
              </attribute>
              <attribute name="ddMMMyyyy">
                <input nameref="ddMMMyyyy" />
              </attribute>
              <attribute name="Retail Forecast Version">
                <input nameref="Retail Forecast Version" />
              </attribute>
              <attribute name="ExcelDate">
                <input nameref="ExcelDate" />
              </attribute>
            </attributes>
          </level>
        </levels>
      </target>
    </transform>
    <transform modified="1602549892330" name="tf-FH [Dim]: FinancialDay" type="TreeFH" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Brings in the attributes associated with each day.]]></comment>
      <sources>
        <source nameref="ex-DW [Dim]: FinancialDays from PTime" />
      </sources>
      <target type="numeric">
        <levels>
          <level>
            <input nameref="LEVLE1" />
          </level>
          <level>
            <input nameref="LEVEL2" />
          </level>
          <level>
            <input nameref="LEVEL3" />
          </level>
          <level>
            <input nameref="LEVEL4" />
          </level>
        </levels>
        <attributes />
      </target>
    </transform>
    <transform name="tf-FT [Dim]: FinancialDay" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Groovy scripts developed by Naked Data

This transform calculates various attribute values.]]></comment>
      <sources>
        <source nameref="ex-DW [Dim]: FinancialDays from PTime" />
      </sources>
      <functions>
        <function name="prevDay" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.DATE, -1);
yesterday = tomorrowCal.time;
String sYear = yesterday.getAt(Calendar.YEAR);
String sDate = yesterday.getAt(Calendar.DATE);
String sNumMonth = yesterday.getAt(Calendar.MONTH)+1;
String sDay = (sDate.toInteger()<10)?"0"+(sDate.toInteger()):(sDate.toInteger());
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
String sLoadYear = (sMonth.toInteger()<7)?sYear:sYear.toInteger()+1;
sTemp1 = Date.parse( 'MM', sNumMonth );
sTemp2 = sTemp1.toString();
Mth = sTemp2.substring(4,7);
FYr = "FY-"+sLoadYear;
prevDay = sYear+sMonth+sDay;]]></script>
            <type><![CDATA[String]]></type>
          </parameters>
        </function>
        <function name="nextDay" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.DATE, 1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
String sDate = tomorrow.getAt(Calendar.DATE);
String sNumMonth = tomorrow.getAt(Calendar.MONTH)+1;
String sDay = (sDate.toInteger()<10)?"0"+(sDate.toInteger()):(sDate.toInteger());
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
String sLoadYear = (sMonth.toInteger()<7)?sYear:sYear.toInteger()+1;
sTemp1 = Date.parse( 'MM', sNumMonth );
sTemp2 = sTemp1.toString();
Mth = sTemp2.substring(4,7);
FYr = "FY-"+sLoadYear;
nextDay = sYear+sMonth+sDay;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="lastDay" type="Groovy">
          <inputs>
            <input nameref="Day" type="String" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
String sYear = tomorrowCal.getAt(Calendar.YEAR);
String sDate = tomorrowCal.getAt(Calendar.DATE);
String sNumMonth = tomorrowCal.getAt(Calendar.MONTH)+1;
int lastDayOfMonth = tomorrowCal.getActualMaximum(Calendar.DAY_OF_MONTH);
String sDay = (lastDayOfMonth<10)?"0"+(lastDayOfMonth):(lastDayOfMonth);
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
String sLoadYear = (sMonth.toInteger()<7)?sYear:sYear.toInteger()+1;
sTemp1 = Date.parse( 'MM', sNumMonth );
sTemp2 = sTemp1.toString();
Mth = sTemp2.substring(4,7);
FYr = "FY-"+sLoadYear;
lastDay = sYear+sMonth+sDay;]]></script>
            <type><![CDATA[String]]></type>
          </parameters>
        </function>
        <function name="prevMonth" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.MONTH, -1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
String sNumMonth = tomorrow.getAt(Calendar.MONTH)+1;
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
prevMonth = sYear+sMonth;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="nextMonth" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.MONTH, 1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
String sNumMonth = tomorrow.getAt(Calendar.MONTH)+1;
String sMonth = (sNumMonth.toInteger()<10)?"0"+sNumMonth:sNumMonth;
nextMonth = sYear+sMonth;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="nextYear" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.YEAR, 1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
nextYear = sYear;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="prevYear" type="Groovy">
          <inputs>
            <input nameref="Day" type="int" />
          </inputs>
          <parameters>
            <script><![CDATA[def Calendar tomorrowCal = Calendar.instance;
tomorrowCal.setTime(Date.parse("yyyyMMdd",_input1.toString()));
tomorrowCal.clearTime();
tomorrowCal.add(Calendar.YEAR, -1);
tomorrow = tomorrowCal.time;
String sYear = tomorrow.getAt(Calendar.YEAR);
prevYear = sYear;]]></script>
            <type><![CDATA[int]]></type>
          </parameters>
        </function>
        <function name="ddMMMyyyy" type="DateFormat">
          <inputs>
            <input nameref="Day" />
          </inputs>
          <parameters>
            <sourceformat>yyyyMMdd</sourceformat>
            <targetformat>dd-MMM-yyyy</targetformat>
            <language>en</language>
          </parameters>
        </function>
        <function name="MMMyyyy" type="DateFormat">
          <inputs>
            <input nameref="Day" />
          </inputs>
          <parameters>
            <sourceformat>yyyyMMdd</sourceformat>
            <targetformat>MMM-yyyy</targetformat>
            <language>en</language>
          </parameters>
        </function>
        <function name="dd/mm/yyyy" type="DateFormat">
          <inputs>
            <input nameref="Day" />
          </inputs>
          <parameters>
            <sourceformat>yyyyMMdd</sourceformat>
            <targetformat>dd/MM/yyyy</targetformat>
            <language>en</language>
          </parameters>
        </function>
      </functions>
    </transform>
    <transform modified="1602549892330" name="tf-FH [Dim] : RetailDay" type="TreeFH" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Brings in the attributes associated with each day.]]></comment>
      <sources>
        <source nameref="ex-DW [Dim]: RetailDays from PTime" />
      </sources>
      <target type="numeric">
        <levels>
          <level>
            <input nameref="LEVLE1" />
          </level>
          <level>
            <input nameref="LEVEL2" />
          </level>
          <level>
            <input nameref="LEVEL3" />
          </level>
          <level>
            <input nameref="LEVEL4" />
          </level>
          <level>
            <input nameref="LEVEL5" />
          </level>
        </levels>
        <attributes />
      </target>
    </transform>
    <transform name="tf-FT [Dim]: Accounts P&amp;L Check" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-Jedox [Dim]: Accounts - P&amp;L" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Source">
            <input constant="PandL" />
          </coordinate>
          <coordinate name="Account">
            <input nameref="level1" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-FT [Dim]: Accounts Stat P&amp;L Check" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-Jedox [Dim]: Accounts - Stat P&amp;L" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Source">
            <input constant="Stat_PandL" />
          </coordinate>
          <coordinate name="Account">
            <input nameref="level1" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform name="tf-FT [Dim]: Financials PandL Check" type="FieldTransform" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-Jedox [Cube]: Stat PandL Balance Check" />
      </sources>
      <functions>
        <function name="PandL Check" type="Aggregation">
          <inputs>
            <input nameref="#Value" />
          </inputs>
          <parameters>
            <aggregate>max</aggregate>
          </parameters>
        </function>
      </functions>
      <target>
        <coordinates>
          <coordinate name="PandL Check">
            <input nameref="PandL Check" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform modified="1602549892330" name="tf-FT [Cube]:Store Calendar - Store Status" type="FieldTransform" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-DW [Store Calendar - Week] Store Status Dates" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Version">
            <input nameref="Version" />
          </coordinate>
          <coordinate name="FYear">
            <input nameref="Year" />
          </coordinate>
          <coordinate name="Period">
            <input nameref="Period" />
          </coordinate>
          <coordinate name="Store">
            <input nameref="Store" />
          </coordinate>
          <coordinate name="Store Status">
            <input nameref="Store Status" />
          </coordinate>
          <coordinate name="#Value">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform modified="1602549892330" name="tf-FT [Cube]:Store Calendar Week - Store Status" type="FieldTransform" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-DW [Store Calendar - Week] Store Status Dates" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Version">
            <input nameref="Version" />
          </coordinate>
          <coordinate name="FYear">
            <input nameref="Year" />
          </coordinate>
          <coordinate name="Week">
            <input nameref="Week" />
          </coordinate>
          <coordinate name="Store">
            <input nameref="Store" />
          </coordinate>
          <coordinate name="Store Status">
            <input nameref="Store Status" />
          </coordinate>
          <coordinate name="#Value">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform modified="1602549892330" name="Duplicate of tf-TD [Cube]: Store Calendar Week - (Comp Type Export to DW)" type="TableDenormalization" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="Duplicate of ex-Jedox [Cube]: Store Calendar Week" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Load Type">
            <input constant="StoreCalendarWeek" />
          </coordinate>
          <coordinate name="Version">
            <input nameref="Version" />
          </coordinate>
          <coordinate name="FYear">
            <input nameref="FYear" />
          </coordinate>
          <coordinate name="TimePeriod">
            <input nameref="Week" />
          </coordinate>
          <coordinate name="Store">
            <input nameref="Store" />
          </coordinate>
        </coordinates>
        <measures denormalize="Store Status">
          <measure aggregate="first" name="Comp Type CY" type="text">
            <input nameref="#Value" />
          </measure>
          <measure aggregate="last" name="Comp Type LY" type="text">
            <input nameref="#Value" />
          </measure>
        </measures>
      </target>
    </transform>
    <transform modified="1602549892330" name="tf-FT [Atr]: Current Financial Period ETL for Parameter Update" type="FieldTransform" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the current period based on date from the DW that will be used to update the Parameter cube.]]></comment>
      <sources>
        <source nameref="ex-DW [Attr] ETL Financial Period" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Attr#_Parameter_">
            <input nameref="#_Parameter_" />
          </coordinate>
          <coordinate name="AttrVersion">
            <input nameref="Parameter" />
          </coordinate>
          <coordinate name="Attr#Value">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform modified="1602549892330" name="tf-FH [Dim] : Day - PayDates for Payroll Cube" type="TreeFH" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Brings in the attributes associated with each day.]]></comment>
      <sources>
        <source nameref="ex-DW [Dim]: Days - PayDates for Payroll Cube" />
      </sources>
      <target type="numeric">
        <levels>
          <level>
            <input nameref="LEVEL1" />
          </level>
          <level>
            <input nameref="LEVEL2" />
          </level>
          <level>
            <input nameref="LEVEL3" />
          </level>
          <level>
            <input nameref="LEVLE4" />
          </level>
        </levels>
        <attributes />
      </target>
    </transform>
    <transform modified="1602549892330" name="tf-FT [Atr]: Current Financial Year ETL for Parameter Update" type="FieldTransform" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Maps the current period based on date from the DW that will be used to update the Parameter cube.]]></comment>
      <sources>
        <source nameref="ex-DW [Attr] ETL Financial Year" />
      </sources>
      <target>
        <coordinates>
          <coordinate name="Attr#_Parameter_">
            <input nameref="#_Parameter_" />
          </coordinate>
          <coordinate name="AttrVersion">
            <input nameref="Parameter" />
          </coordinate>
          <coordinate name="Attr#Value">
            <input nameref="#Value" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
    <transform modified="1602549892330" name="tf-FT [Attr]: Retail ETL Forecast Version" type="FieldTransform" modifiedBy="ONEPAS\richards">
      <sources>
        <source nameref="ex-DW [Attr] Retail ETL Forecast Version" />
      </sources>
      <functions>
        <function name="ETL_Forecast_Version" type="OlapData">
          <inputs>
            <input constant="Retail ETL Forecast" />
            <input nameref="Week" />
          </inputs>
          <parameters>
            <connection>Jedox</connection>
            <cube>#_Week</cube>
          </parameters>
        </function>
      </functions>
      <target>
        <coordinates>
          <coordinate name="#_Parameter_">
            <input nameref="#_Parameter_" />
          </coordinate>
          <coordinate name="Parameter">
            <input nameref="Parameter" />
          </coordinate>
          <coordinate name="#_Language">
            <input constant="~" />
          </coordinate>
          <coordinate name="#Value">
            <input nameref="ETL_Forecast_Version" />
          </coordinate>
        </coordinates>
      </target>
    </transform>
  </transforms>
  <loads>
    <load name="ld-Jedox [Dim]: Current Period Attribute" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Update the Current Period attribute in the period dimension.]]></comment>
      <source nameref="tf-FT [Atr]: Current Period" />
      <connection nameref="Jedox" />
      <dimension name="Period">
        <elements mode="inactive" />
        <consolidations mode="inactive" />
        <attributes mode="add" />
      </dimension>
    </load>
    <load name="ld-Jedox [Dim]: Period - Clear Current Period Attribute" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Update the Current Period attribute in the period dimension.]]></comment>
      <source nameref="tf-FT [Atr]: Current Period Attribute Clear" />
      <connection nameref="Jedox" />
      <dimension name="Period">
        <elements mode="inactive" />
        <consolidations mode="inactive" />
        <attributes mode="add" />
      </dimension>
    </load>
    <load name="ld-Jedox [Dim]: Week - Current Week Attribute" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Update the Current Week attribute in the Week dimension.]]></comment>
      <source nameref="tf-FT [Atr]: Current Week" />
      <connection nameref="Jedox" />
      <dimension name="Week">
        <elements mode="inactive" />
        <consolidations mode="inactive" />
        <attributes mode="add" />
      </dimension>
    </load>
    <load name="ld-Jedox [Dim]: Week - Clear Current Week Attribute" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Update the Current Week attribute in the Week dimension.]]></comment>
      <source nameref="tf-FT [Atr]: Current Week Attribute Clear" />
      <connection nameref="Jedox" />
      <dimension name="Week">
        <elements mode="inactive" />
        <consolidations mode="inactive" />
        <attributes mode="add" />
      </dimension>
    </load>
    <load name="ld-Jedox [Dim]: Year - Clear Current Year Attribute" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Update the Current Week attribute in the Week dimension.]]></comment>
      <source nameref="tf-FT [Atr]: Current Year Attribute Clear" />
      <connection nameref="Jedox" />
      <dimension name="FYear">
        <elements mode="inactive" />
        <consolidations mode="inactive" />
        <attributes mode="add" />
      </dimension>
    </load>
    <load name="ld-Jedox [Dim]: Year- Current Year Attribute" type="Dimension" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Update the Current Week attribute in the Week dimension.]]></comment>
      <source nameref="tf-FT [Atr]: Current Year" />
      <connection nameref="Jedox" />
      <dimension name="FYear">
        <elements mode="inactive" />
        <consolidations mode="inactive" />
        <attributes mode="add" />
      </dimension>
    </load>
    <load name="ld-Jedox [Cube] Parameters - Week" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Updates the Week parameter in the #_Parameters cube]]></comment>
      <source nameref="tf-FT [Atr]: Current Week for Parameter Update" />
      <connection nameref="Jedox" />
      <cube name="#_Parameter" splash="disabled" cubeLayoutChangeMode="noneWithDefaultWrite">
        <dimensions>
          <dimension input="Attr#_Parameter_" name="#_Parameter_" />
          <dimension input="AttrVersion" name="Parameter" />
        </dimensions>
      </cube>
      <mode>insert</mode>
    </load>
    <load name="ld-File: Export Current Week Value" type="File" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Writes the value of the current week based on the current date to a text file.]]></comment>
      <source nameref="tf-FT [Atr]: Current Week for Current Week Text File" />
      <connection nameref="CurrentWeekTextFile" />
      <mode>create</mode>
    </load>
    <load name="ld-File: Parameter Cube Export" type="File" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <source nameref="tf-FT [Cube]: Parameter Cube Export for File" />
      <connection nameref="Parameter Cube Contents" />
      <mode>create</mode>
    </load>
    <load modified="1602549892330" name="ld-DW JedoxParameters" type="Relational" modifiedBy="ONEPAS\richards">
      <source nameref="tf-FT [Cube]: Parameter Cube Export for DW" />
      <connection nameref="DW" />
      <mode>update</mode>
      <table name="SysJedoxParameters" schema="dbo" />
    </load>
    <load name="Load FY14 Forecast" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <source nameref="Convert Actual to Forecast" />
      <connection nameref="Jedox" />
      <mode>add</mode>
      <cube name="Retail Sales Weekly" splash="disabled" cubeLayoutChangeMode="noneWithDefaultWrite" />
    </load>
    <load name="ld-Jedox [Cube] ETL_Parameters - Week" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Updates the Week parameter in the #_Parameters cube]]></comment>
      <source nameref="tf-FT [Atr]: Current Week for Parameter Update" />
      <connection nameref="Jedox" />
      <mode>insert</mode>
      <cube name="#_ETL Parameters" splash="disabled" cubeLayoutChangeMode="noneWithDefaultWrite">
        <dimensions>
          <dimension input="Attr#_Parameter_" name="#_ETL Parameters_" />
          <dimension input="AttrVersion" name="ETL Parameters" />
        </dimensions>
      </cube>
    </load>
    <load name="ld-Jedox [Cube] Store Calendar - Store Status Dates" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Loads the store open/closed refurbstart/end dates from the profit centre view into the Store Calendar cube for use by the comp rules.
This]]></comment>
      <source nameref="ex-DW [Store Calendar] Store Status Dates" />
      <connection nameref="Jedox" />
      <mode>insert</mode>
      <cube name="Store Calendar" splash="disabled" cubeLayoutChangeMode="noneWithDefaultWrite">
        <dimensions>
          <dimension input="Version" name="Version" />
          <dimension input="Year" name="FYear" />
          <dimension input="Period" name="Period" />
          <dimension input="Store" name="Store" />
          <dimension input="Store Status" name="Store Status" />
        </dimensions>
      </cube>
    </load>
    <load name="ld-Jedox [Cube] Store Calendar Week - Store Status Dates" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Loads the store open/closed refurbstart/end dates from the profit centre view into the Store Calendar cube for use by the comp rules.
This]]></comment>
      <source nameref="ex-DW [Store Calendar Week ] Store Status Dates" />
      <connection nameref="Jedox" />
      <mode>insert</mode>
      <cube name="Store Calendar Week" splash="disabled" cubeLayoutChangeMode="noneWithDefaultWrite">
        <dimensions>
          <dimension input="Version" name="Version" />
          <dimension input="Year" name="FYear" />
          <dimension input="Week" name="Week" />
          <dimension input="Store" name="Store" />
          <dimension input="Store Status" name="Store Status" />
        </dimensions>
      </cube>
    </load>
    <load name="ld-DW AP21 Store Polling Data (Raw)" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Loads the data from AP21 Store view into a table so it can be joined to the locations in Jedox]]></comment>
      <source nameref="ex-AP21 Store Polling Data (Raw)" />
      <connection nameref="DW" />
      <mode>create</mode>
      <table name="AP21_Store_Polling_Data" schema="FIN" aggregate="false" />
    </load>
    <load name="ld-DW Store Polling Data (Transformed)" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Loads the transformed polling data into a table.]]></comment>
      <source nameref="ex-DW AP21 Store Polling Data (Transform)" />
      <connection nameref="DW" />
      <mode>add</mode>
      <table name="Store_Polling_Data" schema="Fin" />
    </load>
    <load name="ld-DW SalesDaily Update" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Loaded the SalesDaily update date time into the Status table]]></comment>
      <source nameref="ex-DW SalesDaily Update Time" />
      <connection nameref="DW" />
      <mode>add</mode>
      <table name="Status" schema="Fin" aggregate="false" />
    </load>
    <load name="ld-File SalesDaily Update Details" type="File" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Write out the update times to a text file to be sent via email.]]></comment>
      <source nameref="ex-DW SalesDaily Update Time" />
      <connection nameref="file-SalesDailyUpdate" />
      <mode>create</mode>
    </load>
    <load modified="1602549892330" name="ld-DW Store Comp Types - Store Calendar Week" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Loads the comp types FROM STORE CALENDAR WEEK cube into the DW table Jedox_Store_CompType
NOTE: This job uses UPDATE mode which means it will delete the contents of the table prior to loading

THIS JOB must be run BEFORE the Store Calendar comp type load]]></comment>
      <source nameref="tf-TD [Cube]: Store Calendar Week - (Comp Type Export to DW)" />
      <connection nameref="DW Raw" />
      <mode>create</mode>
      <table name="JEDOX_STORE_COMPTYPE" schema="dbo" />
    </load>
    <load modified="1602549892330" name="ld-DW Status (Profit Centre Attribute Checksum)" type="Relational" modifiedBy="ONEPAS\richards">
      <source nameref="ex-DW [vProfCen] Profit Centre Attribute Checksum" />
      <connection nameref="DW" />
      <mode>add</mode>
      <table name="Status" schema="dbo" />
    </load>
    <load name="ld-Jedox [Cube] Parameters - Store Attribute Update" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <source nameref="ex-DW [Status] Store Attribute Update" />
      <connection nameref="Jedox" />
      <mode>insert</mode>
      <cube name="#_Parameter" splash="disabled" cubeLayoutChangeMode="noneWithDefaultWrite">
        <dimensions>
          <dimension input="#_Parameter_" name="#_Parameter_" />
          <dimension input="Parameter" name="Parameter" />
        </dimensions>
      </cube>
    </load>
    <load modified="1602549892330" name="ld-DW Store Comp Types - Store Calendar" type="Relational" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Loads the comp types  FROM STORE CALENDAR cube into the DW table Jedox_Store_CompType
NOTE: This job uses INSERT mode which means it will NOT delete ANY DATA. 

IT MUST BE RUN AFTER THE STORE CALENDAR WEEK COMP TYPE LOAD.]]></comment>
      <source nameref="tf-TD [Cube]: Store Calendar - (Comp Type Export to DW)" />
      <connection nameref="DW Raw" />
      <mode>insert</mode>
      <table name="JEDOX_STORE_COMPTYPE" schema="dbo" />
    </load>
    <load name="ld-Jedox [Cube] Store Polling" type="Cube" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <source nameref="ex-DW AP21 Store Polling Data (F_StorePollData)" />
      <connection nameref="Jedox" />
      <mode>update</mode>
      <cube name="Store Polling" splash="disabled" cubeLayoutChangeMode="noneWithDefaultWrite">
        <dimensions>
          <dimension input="Store" name="Store" />
          <dimension input="RetailDay" name="RetailDay" />
          <dimension input="Store Polling Measure" name="Store Polling Measures" />
        </dimensions>
      </cube>
    </load>
    <load modified="1602549892330" name="ld-Jedox-[Dim] : Day" type="Dimension" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Uses insert functionality...
inser The same as "add", with the following exception: duplicate consolidations are deleted and replaced with new consolidations
Target dimension name is set in the variable DateDimName]]></comment>
      <source nameref="tf-FH [Dim] : Day" />
      <connection nameref="Jedox" />
      <dimension name="Day">
        <elements mode="add" />
        <consolidations mode="add" />
        <attributes mode="add" />
      </dimension>
    </load>
    <load modified="1602549892330" name="ld-Jedox-[Dim] : RetailDay" type="Dimension" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Uses insert functionality...
inser The same as "add", with the following exception: duplicate consolidations are deleted and replaced with new consolidations
Target dimension name is set in the variable DateDimName]]></comment>
      <source nameref="tf-FH [Dim] : RetailDay" />
      <connection nameref="Jedox" />
      <dimension name="Day">
        <elements mode="add" />
        <consolidations mode="add" />
        <attributes mode="inactive" />
      </dimension>
    </load>
    <load modified="1602549892330" name="ld-Jedox-[Dim]: FinancialDay" type="Dimension" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Uses insert functionality...
inser The same as "add", with the following exception: duplicate consolidations are deleted and replaced with new consolidations
Target dimension name is set in the variable DateDimName]]></comment>
      <source nameref="tf-FH [Dim]: FinancialDay" />
      <connection nameref="Jedox" />
      <dimension name="Day">
        <elements mode="add" />
        <consolidations mode="add" />
        <attributes mode="inactive" />
      </dimension>
    </load>
    <load name="zz Testing ld-DW Store Comp Types - Store Calendar Week" type="Relational" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Loads the comp types FROM STORE CALENDAR WEEK cube into the DW table Jedox_Store_CompType
NOTE: This job uses UPDATE mode which means it will delete the contents of the table prior to loading

THIS JOB must be run BEFORE the Store Calendar comp type load]]></comment>
      <source nameref="tf-TD [Cube]: Store Calendar Week - (Comp Type Export to DW)" />
      <connection nameref="DW" />
      <mode>update</mode>
      <table name="zzTesting_Jedox_Store_CompType" schema="FIN" />
    </load>
    <load modified="1602549892330" name="ld-DW PandL Check" type="Relational" modifiedBy="ONEPAS\richards">
      <source nameref="tf-FT [Dim]: Accounts P&amp;L Check" />
      <connection nameref="DW Raw" />
      <mode>create</mode>
      <table name="JEDOX_STAT_PANDL_CHECK" schema="dbo" />
    </load>
    <load modified="1602549892330" name="ld-DW Stat PandL Check" type="Relational" modifiedBy="ONEPAS\richards">
      <source nameref="tf-FT [Dim]: Accounts Stat P&amp;L Check" />
      <connection nameref="DW Raw" />
      <mode>add</mode>
      <table name="JEDOX_STAT_PANDL_CHECK" schema="dbo" />
    </load>
    <load name="ld-File: Stat PandL Check" type="File" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <source nameref="ex-DW [Dim] Account - Stat PandL Check" />
      <connection nameref="Stat PandL Check" />
      <mode>create</mode>
    </load>
    <load modified="1602549892330" name="ld-Jedox [Cube] Store Calendar - Store Status Dates - New" type="Cube" modifiedBy="ONEPAS\richards">
      <source nameref="tf-FT [Cube]:Store Calendar - Store Status" />
      <connection nameref="Jedox" />
      <mode>insert</mode>
      <cube name="Store Calendar" splash="disabled" cubeLayoutChangeMode="noneWithDefaultWrite">
        <dimensions>
          <dimension input="Version" name="Version" />
          <dimension input="FYear" name="FYear" />
          <dimension input="Period" name="Period" />
          <dimension input="Store" name="Store" />
          <dimension input="Store Status" name="Store Status" />
        </dimensions>
      </cube>
    </load>
    <load modified="1602549892330" name="ld-Jedox [Cube] Store Calendar Week - Store Status Dates - New" type="Cube" modifiedBy="ONEPAS\richards">
      <source nameref="tf-FT [Cube]:Store Calendar Week - Store Status" />
      <connection nameref="Jedox" />
      <mode>insert</mode>
      <cube name="Store Calendar Week" splash="disabled" cubeLayoutChangeMode="noneWithDefaultWrite">
        <dimensions>
          <dimension input="Version" name="Version" />
          <dimension input="FYear" name="FYear" />
          <dimension input="Week" name="Week" />
          <dimension input="Store" name="Store" />
          <dimension input="Store Status" name="Store Status" />
        </dimensions>
      </cube>
    </load>
    <load modified="1602549892330" name="New Load" type="RelationalSQL" modifiedBy="ONEPAS\richards">
      <connection nameref="DW" />
      <query><![CDATA[SELECT [Code]
  + [Name]
  + [ProfitCentreType]
  + [State]
  + [Country]
  + CONVERT(VARCHAR(12),[AreaInSquareMeters])
  + CONVERT(VARCHAR(12),[StartupCapitalExpenditure])
  + [StoreGrading]
  + CONVERT(VARCHAR(12),[OpenDate])
  + CONVERT(VARCHAR(12),[CloseDate])
  + CONVERT(VARCHAR(12),[BudgetOpenDate])
  + CONVERT(VARCHAR(12),[BudgetCloseDate])
  + CONVERT(VARCHAR(12), [BudgetOpenDateCurrentYear])
  + CONVERT(VARCHAR(12),[BudgetCloseDateCurrentYear])
  + CONVERT(VARCHAR(12),[ForecastOpenDate])
  + CONVERT(VARCHAR(12),[ForecastCloseDate])
  + CONVERT(VARCHAR(12),[RefurbishStartDate])
  + CONVERT(VARCHAR(12),[RefurbishEndDate])
  + CONVERT(VARCHAR(12),[RefurbishStartDateBudget])
  + CONVERT(VARCHAR(12),[RefurbishEndDateBudget])
  + CONVERT(VARCHAR(12),[RefurbishStartDateBudgetCurrentYear])
  + CONVERT(VARCHAR(12),[RefurbishEndDateBudgetCurrentYear])
  + CONVERT(VARCHAR(12),[RefurbishStartDateForecast])
  + CONVERT(VARCHAR(12),[RefurbishEndDateForecast])
  + CONVERT(VARCHAR(12),[CurrentBusinessDivisionId])
  + CONVERT(VARCHAR(12),[CurrentLegalEntityId])
  + CONVERT(VARCHAR(12),[IsLegacy])
  + CONVERT(VARCHAR(12),[ProfitCentreCurrencyId]) AS storestatus
INTO #a
FROM [dbo].[DimProfitCentre]
GO
SET CONCAT_NULL_YIELDS_NULL ON
GO

DECLARE @Txt1 VARCHAR(MAX)
SET @Txt1=''
 
SELECT  @Txt1 = @Txt1 + storestatus 
FROM    #a

UPDATE [PlayPen].[dbo].[SysConfiguration]
   SET [ConfigurationValue] = checksum(LEFT(@Txt1,LEN(@Txt1)-1))
      ,[UpdateDate] = getdate()
      ,[UpdateUser] = suser_name()
 WHERE [ConfigurationKey] = 'ETLProfitCentreAttributeChecksum'

--SELECT 'ETLProfitCentreAttributeChecksum' as [ConfigurationKey], GetDate() as [Date], '' as [Description],  checksum(LEFT(@Txt1,LEN(@Txt1)-1)) as 'Value'
drop table #a]]></query>
    </load>
    <load modified="1602549892330" name="ld-File: Review Concession Profit Centre Check" type="File" modifiedBy="ONEPAS\richards">
      <source nameref="ex-DW [Dim]: Review Profit Centre Concession Check" />
      <connection nameref="Review Concession Profit Centre  Check" />
      <mode>create</mode>
    </load>
    <load modified="1602549892330" name="ld-DW Review Profit Centre Concessions" type="Relational" modifiedBy="ONEPAS\richards">
      <source nameref="ex-Jedox Review Profit Centre Concessions" />
      <connection nameref="DW Raw" />
      <mode>create</mode>
      <table name="JEDOX_REVIEW_PROFITCENTRE_CONCESSIONS" schema="dbo" />
    </load>
    <load modified="1602549892330" name="ld-DW Review Reporting Concessions" type="Relational" modifiedBy="ONEPAS\richards">
      <source nameref="ex-Jedox Review Reporting Concessions" />
      <connection nameref="DW Raw" />
      <mode>create</mode>
      <table name="JEDOX_REVIEW_REPORTING_CONCESSIONS" schema="dbo" />
    </load>
    <load modified="1602549892330" name="ld-Jedox [Cube] Parameters - Current Period ETL" type="Cube" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Updates the Current Period ETL parameter in the #_Parameters cube]]></comment>
      <source nameref="tf-FT [Atr]: Current Financial Period ETL for Parameter Update" />
      <connection nameref="Jedox" />
      <mode>insert</mode>
      <cube cubeLayoutChangeMode="noneWithDefaultWrite" name="#_Parameter" splash="disabled">
        <dimensions>
          <dimension input="Attr#_Parameter_" name="#_Parameter_" />
          <dimension input="AttrVersion" name="Parameter" />
        </dimensions>
      </cube>
    </load>
    <load modified="1602549892330" name="ld-Jedox-[Dim] : Day - PayDates for Payroll Cube" type="Dimension" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Uses insert functionality...
inser The same as "add", with the following exception: duplicate consolidations are deleted and replaced with new consolidations
Target dimension name is set in the variable DateDimName]]></comment>
      <source nameref="tf-FH [Dim] : Day - PayDates for Payroll Cube" />
      <connection nameref="Jedox" />
      <dimension name="Day">
        <elements mode="add" />
        <consolidations mode="add" />
        <attributes mode="inactive" />
      </dimension>
    </load>
    <load modified="1602549892330" name="ld-Jedox [Cube] Parameters - Current Financial Year ETL" type="Cube" modifiedBy="ONEPAS\richards">
      <comment><![CDATA[Updates the Current Period ETL parameter in the #_Parameters cube]]></comment>
      <source nameref="tf-FT [Atr]: Current Financial Year ETL for Parameter Update" />
      <connection nameref="Jedox" />
      <mode>insert</mode>
      <cube cubeLayoutChangeMode="noneWithDefaultWrite" name="#_Parameter" splash="disabled">
        <dimensions>
          <dimension input="Attr#_Parameter_" name="#_Parameter_" />
          <dimension input="AttrVersion" name="Parameter" />
        </dimensions>
      </cube>
    </load>
    <load modified="1602549892330" name="ld-Jedox [Cube] Parameters - Retail ETL Forecast" type="Cube" modifiedBy="ONEPAS\richards">
      <source nameref="tf-FT [Attr]: Retail ETL Forecast Version" />
      <connection nameref="Jedox" />
      <mode>insert</mode>
      <bulksize>100000</bulksize>
      <cube cubeLayoutChangeMode="none" name="#_Parameter" splash="disabled">
        <dimensions>
          <dimension input="#_Parameter_" name="#_Parameter_" />
          <dimension input="Parameter" name="Parameter" />
          <dimension input="#_Language" name="#_LANGUAGE" />
        </dimensions>
      </cube>
    </load>
  </loads>
  <jobs>
    <job name="[01-01]-load[Attr] Period - Current Period" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox [Dim]: Period - Clear Current Period Attribute" type="load" />
        <execution nameref="ld-Jedox [Dim]: Current Period Attribute" type="load" />
      </executions>
      <comment><![CDATA[Updates the current period attribute in the Period dimension]]></comment>
    </job>
    <job name="[01-02]-load[Attr] Week - Current Week" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox [Dim]: Week - Clear Current Week Attribute" type="load" />
        <execution nameref="ld-Jedox [Dim]: Week - Current Week Attribute" type="load" />
      </executions>
      <comment><![CDATA[Updates the current week attribute in the Week dimension]]></comment>
    </job>
    <job name="[01-03]-load[Attr]:FYear - Current Year" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox [Dim]: Year - Clear Current Year Attribute" type="load" />
        <execution nameref="ld-Jedox [Dim]: Year- Current Year Attribute" type="load" />
      </executions>
      <comment><![CDATA[Updates the current Year attribute in the FYear dimension]]></comment>
    </job>
    <job modified="1602549892330" name="[01-04]-load[Cube]:Parameter - Week" type="Standard" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox [Cube] Parameters - Week" type="load" />
        <execution nameref="ld-Jedox [Cube] Parameters - Current Period ETL" type="load" />
        <execution nameref="ld-Jedox [Cube] Parameters - Current Financial Year ETL" type="load" />
        <execution nameref="ld-File: Export Current Week Value" type="load" />
        <execution nameref="ld-File: Parameter Cube Export" type="load" />
      </executions>
      <comment><![CDATA[Updates the Week in the #_Parameter for reporting and #_ETL_Parameters cubes based on the Retail week from the PTime table in the DW using the current date.
Then exports the value of the current week to a file for use in email.
Then exports the value of the #_Parameter cube to a file for use in email.]]></comment>
      <failStatus>error</failStatus>
    </job>
    <job name="[01-05]-load[DW]:Jedox_Parameters Table" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-DW JedoxParameters" type="load" />
      </executions>
      <comment><![CDATA[Updates JedoxParameters table in PAS_DWH]]></comment>
    </job>
    <job name="[01-06]-Export[Cube]:Parameters to File" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-File: Parameter Cube Export" type="load" />
      </executions>
      <comment><![CDATA[Exports the contents of the ETL_Parameter cube to a text file for use during the nightly processing.]]></comment>
    </job>
    <job name="[01-07]-load [Cube]:Store Calendar and Store Calendar Week - Store Status Dates" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox [Cube] Store Calendar - Store Status Dates" type="load" />
        <execution nameref="ld-Jedox [Cube] Store Calendar Week - Store Status Dates" type="load" />
      </executions>
      <comment><![CDATA[Loads store status dates from vProfCen (view of profcen table) into the store calendar cube.
Load StoreOpenDate StoreOpenDateS, StoreCloseDate, RefurbStartDate RefurbEndDate]]></comment>
    </job>
    <job name="[01-09]-Load AP21 Store Poll Data" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-DW AP21 Store Polling Data (Raw)" type="load" />
        <execution nameref="ld-DW Store Polling Data (Transformed)" type="load" />
        <execution nameref="ld-Jedox [Cube] Store Polling" type="load" />
      </executions>
      <comment><![CDATA[Extracts store polling information from AP21, transforms it into Jedox format (profit centres) and loads it into the Store_Polling_Data table]]></comment>
    </job>
    <job name="[01-10]-Update Status Table with SalesDaily Load Dates" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-DW SalesDaily Update" type="load" />
        <execution nameref="ld-File SalesDaily Update Details" type="load" />
      </executions>
      <comment><![CDATA[Updates the status table with the date and time when the SalesDaily table in the DW was updated overnight. 
The same values are written to a file for email attachment on Mondays.]]></comment>
    </job>
    <job name="[01-08]-Load Store Comp Type into DW" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-DW Store Comp Types - Store Calendar Week" type="load" />
        <execution nameref="ld-DW Store Comp Types - Store Calendar" type="load" />
      </executions>
      <comment><![CDATA[Extracts the comp types from the Store Calendar Week and Store Calendar cubes in Jedox. 
The jobs must be run in this order (SCW then SC) as the SCW job clears the table prior to reloading.
This job is only run on an "as needed" basis and relies on job 01-11 to determine whether or not it is required.
The store comp type by week/period is then used during the data load for the Retail and Retail Sales Weekly cubes to improve performance during the data loads.]]></comment>
    </job>
    <job modified="1602549892330" name="[01-11]-Parameter Cube Export" type="Standard" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-File: Parameter Cube Export" type="load" />
      </executions>
      <comment><![CDATA[Updates the Status table in the DW with a checksum of all attribute values in the vProfCen view.
The checksum is used to determine if an attribute value has changed. 
The ETL Parameter cube is updated with the word Update when an attribute changes, otherwise the words NoChange is written to the ETL parameter cube.
These values are used to determine whether or not the Comp Types need to be exported from the Store Calendar and Store Calendar Week cubes because of a change in date which will affect the comp dates.]]></comment>
      <failStatus>error</failStatus>
    </job>
    <job name="[01-12]-load Dim Days" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox-[Dim] : Day" type="load" />
      </executions>
    </job>
    <job name="[01-13-00]-Load Retail - Financial Days Dimensions" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="[01-13-01]-load Dim FinancialDays" type="job" />
        <execution nameref="[01-13-02]-load Dim RetailDays" type="job" />
      </executions>
      <comment><![CDATA[This is the master job that runs the 2 separate jobs to build
1. FinancialDays dimension
2. RetailDays dimension]]></comment>
    </job>
    <job name="[01-13-01]-load Dim FinancialDays" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox-[Dim]: FinancialDay" type="load" />
      </executions>
    </job>
    <job name="[01-13-02]-load Dim RetailDays" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox-[Dim] : RetailDay" type="load" />
      </executions>
    </job>
    <job name="[99-01]-Nightly Sequence - Start" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="[01-11]-Parameter Cube Export" type="job" />
      </executions>
      <comment><![CDATA[This is a job that is meant to be run interactively. It simulates the admin jobs that are run as part of the nightly batch process.]]></comment>
    </job>
    <job name="[01-14]-Stat PandL Check" type="Standard" modified="1602549892330" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-DW PandL Check" type="load" />
        <execution nameref="ld-DW Stat PandL Check" type="load" />
        <execution nameref="ld-File: Stat PandL Check" type="load" />
      </executions>
      <comment><![CDATA[Extracts the accounts from the P&L and Stat P&L hierarchies and puts them in the table Fin.Dim_Stat_PandL_Check in PAS_DWH
Then runs a SQL statement using the except clause looking for accounts that are in the P&L and not in Stat P&L
The results are written to the file C:\Progra~1\Jedox\Jedox Suite\tomcat\client\StatPandLCheck.txt on the server MTWJED01

NOTE: The order is important ad the load ld-DW PandL Check creates that table!!]]></comment>
    </job>
    <job modified="1602549892330" name="[01-15]-Review Concession Profit Centre Check" type="Standard" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-DW Review Profit Centre Concessions" type="load" />
        <execution nameref="ld-DW Review Reporting Concessions" type="load" />
        <execution nameref="ld-File: Review Concession Profit Centre Check" type="load" />
      </executions>
      <failStatus>error</failStatus>
    </job>
    <job modified="1602549892330" name="[01-13-02]-load Dim Day - PayDates for Payroll Cube" type="Standard" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox-[Dim] : Day - PayDates for Payroll Cube" type="load" />
      </executions>
      <failStatus>error</failStatus>
    </job>
    <job modified="1602549892330" name="[01-16]-Nightly Update Retail ETL Forecast Version" type="Standard" modifiedBy="ONEPAS\richards">
      <executions>
        <execution nameref="ld-Jedox [Cube] Parameters - Retail ETL Forecast" type="load" />
      </executions>
      <failStatus>error</failStatus>
    </job>
  </jobs>
</project>
